<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ - The Carpetmaker</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --purple-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --text-dark: #1f2933;
      --text-light: #6b7280;
      --border: #e2e8f0;
      --danger: #ef4444;
      --success: #10b981;
      --bg-soft: #f9fafb;
    }

    body {
      font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--purple-gradient);
      min-height: 100vh;
      padding: 32px 12px;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,0.12) 0, transparent 55%),
        radial-gradient(circle at 80% 80%, rgba(255,255,255,0.08) 0, transparent 60%);
      pointer-events: none;
      animation: float 18s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-18px); }
    }

    .container {
      max-width: 980px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 28px 28px 32px;
      box-shadow: 0 20px 60px rgba(15,23,42,0.35);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 18px;
      margin-bottom: 24px;
      border-bottom: 2px solid #e5e7eb;
    }

    .card-header-icon {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: #fbbf24;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .card-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-dark);
    }

    .card-subtitle {
      font-size: 13px;
      color: var(--text-light);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .btn-back {
      background: rgba(255,255,255,0.2);
      color: #f9fafb;
      border-radius: 999px;
      padding: 8px 16px;
      border: 1px solid rgba(255,255,255,0.5);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all .2s ease;
    }

    .btn-back:hover {
      transform: translateX(-2px);
      background: rgba(255,255,255,0.32);
    }

    /* Form layout */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 18px 20px;
      margin-bottom: 24px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group.full {
      grid-column: 1 / -1;
    }

    label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-dark);
    }

    .required::after {
      content: ' *';
      color: var(--danger);
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-family: inherit;
      font-size: 14px;
      transition: all .18s ease;
      background: #ffffff;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99,102,241,0.18);
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    select:disabled {
      background: #f3f4f6;
      color: #9ca3af;
      cursor: wait;
    }

    .muted {
      font-size: 12px;
      color: var(--text-light);
    }

    /* Action section */
    .section-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--text-dark);
    }

    .action-wrapper {
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 16px 18px 18px;
      margin-bottom: 22px;
    }

    .action-grid {
      display: grid;
      grid-template-columns: minmax(0, 220px) minmax(0, 1fr);
      column-gap: 16px;
      row-gap: 8px;
    }

    .action-left {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-dark);
    }

    .action-left span {
      white-space: nowrap;
    }

    .action-detail-input {
      width: 100%;
      padding: 8px 10px;
      font-size: 13px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #ffffff;
    }

    .action-detail-input:disabled {
      background: #e5e7eb;
      cursor: not-allowed;
    }

    .action-note {
      font-size: 11px;
      color: var(--text-light);
      margin-top: 4px;
    }

    /* Signature */
    .signature-section {
      margin-top: 8px;
    }

    .signature-box {
      border-radius: 12px;
      border: 1px dashed #cbd5f5;
      background: #f3f4ff;
      padding: 10px 10px 6px;
    }

    .signature-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .signature-title {
      font-size: 13px;
      font-weight: 600;
      color: #4c1d95;
    }

    canvas#signaturePad {
      width: 100%;
      height: 160px;
      border-radius: 10px;
      background: #ffffff;
      border: 1px solid #d1d5f0;
      display: block;
    }

    .btn-ghost {
      border-radius: 999px;
      border: 1px solid #c4b5fd;
      background: rgba(255,255,255,0.85);
      font-size: 12px;
      padding: 4px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: #4c1d95;
    }

    .btn-ghost:hover {
      background: #ede9fe;
    }

    /* Submit button */
    .actions-footer {
      margin-top: 22px;
      display: flex;
      justify-content: flex-end;
    }

    .btn-primary {
      padding: 11px 24px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg,#6366f1,#ec4899);
      color: #ffffff;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 10px 25px rgba(79,70,229,0.45);
      transition: all .2s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 35px rgba(79,70,229,0.55);
    }

    .btn-primary:disabled {
      opacity: .6;
      cursor: wait;
      box-shadow: none;
      transform: none;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 18px;
      right: 18px;
      padding: 14px 20px;
      border-radius: 999px;
      background: var(--success);
      color: #ffffff;
      font-size: 13px;
      font-weight: 600;
      box-shadow: 0 14px 40px rgba(16,185,129,0.45);
      display: none;
      z-index: 9999;
    }
    .notification.error {
      background: #ef4444;
      box-shadow: 0 14px 40px rgba(239,68,68,0.45);
    }
    .notification.show {
      display: block;
      animation: slideIn .3s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(260px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @media (max-width: 768px) {
      body { padding: 20px 10px; }
      .card { padding: 20px 16px 22px; }
      .form-grid { grid-template-columns: 1fr; }
      .action-grid { grid-template-columns: minmax(0,1fr); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-top">
      <button class="btn-back" type="button" onclick="goBack()">
        <span>‚Üê</span> ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
      </button>
      <div style="color:#e5e7eb;font-size:13px;">The Carpetmaker (Thailand) Co., Ltd.</div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-header-icon">üìÑ</div>
        <div>
          <div class="card-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
          <div class="card-subtitle">‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div>
        </div>
      </div>

      <form id="actionForm">
        <!-- Employee info -->
        <div class="form-grid">
          <div class="form-group full">
            <label for="employeeSelect" class="required">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
            <select id="employeeSelect" required disabled>
              <option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô...</option>
            </select>
            <div class="muted">‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï "‡∏ú‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå" ‡πÉ‡∏ô HRD demo</div>
          </div>

          <div class="form-group">
            <label for="empCode" class="required">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
            <input type="text" id="empCode" required>
          </div>

          <div class="form-group">
            <label for="startDate" class="required">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</label>
            <input type="date" id="startDate" required>
          </div>

          <div class="form-group">
            <label for="currentPosition" class="required">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
            <input type="text" id="currentPosition" required>
          </div>

          <div class="form-group">
            <label for="dept" class="required">‡πÅ‡∏ú‡∏ô‡∏Å</label>
            <input type="text" id="dept" required>
          </div>

          <div class="form-group">
            <label for="division" class="required">‡∏ù‡πà‡∏≤‡∏¢</label>
            <input type="text" id="division" required>
          </div>

          <div class="form-group">
            <label for="employmentType" class="required">‡∏™‡∏†‡∏≤‡∏û‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô</label>
            <input type="text" id="employmentType" required>
          </div>
        </div>

        <!-- Actions -->
        <div style="margin-top:8px;margin-bottom:6px;">
          <div class="section-title">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ <span style="color:#ef4444;">*</span></div>
        </div>

        <div class="action-wrapper">
          <div class="action-grid">
            <!-- ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á -->
            <label class="action-left">
              <input type="radio" name="actionType" value="appoint" data-label="‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á" required>
              <span>‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-appoint"
                class="action-detail-input"
                placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏î"
                disabled
              >
            </div>

            <!-- ‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢ -->
            <label class="action-left">
              <input type="radio" name="actionType" value="transfer" data-label="‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢">
              <span>‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-transfer"
                class="action-detail-input"
                placeholder="‡πÇ‡∏≠‡∏ô‡∏à‡∏≤‡∏Å/‡πÑ‡∏õ ‡πÅ‡∏ú‡∏ô‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏ù‡πà‡∏≤‡∏¢‡πÉ‡∏î"
                disabled
              >
            </div>

            <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û -->
            <label class="action-left">
              <input type="radio" name="actionType" value="changeCondition" data-label="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û">
              <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-changeCondition"
                class="action-detail-input"
                placeholder="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å / ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏∞‡πÑ‡∏£"
                disabled
              >
            </div>

            <!-- ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á -->
            <label class="action-left">
              <input type="radio" name="actionType" value="promote" data-label="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
              <span>‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-promote"
                class="action-detail-input"
                placeholder="‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏≤‡∏Å / ‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏î"
                disabled
              >
            </div>

            <!-- ‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô -->
            <label class="action-left">
              <input type="radio" name="actionType" value="passProbation" data-label="‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô">
              <span>‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-passProbation"
                class="action-detail-input"
                placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß"
                disabled
              >
            </div>

            <!-- ‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à/‡∏•‡∏≤‡∏≠‡∏≠‡∏Å -->
            <label class="action-left">
              <input type="radio" name="actionType" value="terminate" data-label="‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à/‡∏•‡∏≤‡∏≠‡∏≠‡∏Å">
              <span>‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à/‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-terminate"
                class="action-detail-input"
                placeholder="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏à‡πâ‡∏≤‡∏á"
                disabled
              >
            </div>

            <!-- ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
            <label class="action-left">
              <input type="radio" name="actionType" value="increaseSalary" data-label="‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">
              <span>‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-increaseSalary"
                class="action-detail-input"
                placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô/‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°"
                disabled
              >
            </div>

            <!-- ‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
            <label class="action-left">
              <input type="radio" name="actionType" value="decreaseSalary" data-label="‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">
              <span>‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-decreaseSalary"
                class="action-detail-input"
                placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô/‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏î/‡∏ï‡∏±‡∏î"
                disabled
              >
            </div>

            <!-- ‡∏≠‡∏∑‡πà‡∏ô‡πÜ -->
            <label class="action-left">
              <input type="radio" name="actionType" value="other" data-label="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">
              <span>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</span>
            </label>
            <div>
              <input
                type="text"
                id="detail-other"
                class="action-detail-input"
                placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ"
                disabled
              >
            </div>
          </div>

          <div class="action-note">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á 1 ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
          </div>
        </div>

        <!-- Extra detail & effective date -->
        <div class="form-grid">
          <div class="form-group full">
            <label for="extraDetail">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
            <textarea id="extraDetail" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
          </div>

          <div class="form-group">
            <label for="effectiveDate" class="required">‡∏°‡∏µ‡∏ú‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="effectiveDate" required>
          </div>
        </div>

        <!-- Signature -->
        <div class="signature-section">
          <label class="required">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠ (HR)</label>
          <div class="signature-box">
            <div class="signature-header">
              <div class="signature-title">‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</div>
              <button class="btn-ghost" type="button" onclick="clearSignature()">
                ‚úï ‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
              </button>
            </div>
            <canvas id="signaturePad"></canvas>
          </div>
        </div>

        <div class="actions-footer">
          <button type="submit" class="btn-primary" id="submitBtn">
            ‚úì ‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
          </button>
        </div>
      </form>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script>
    // =========================
    // CONFIG
    // =========================
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbxyIpBQpwNtif7AJA08A4c6yG_IAIRcd3emPM_OCmqrrKBIc1bYjfWffAw2PTphsoxu/exec';

    let EMPLOYEES = [];
    let EMP_MAP = {};

    let sigCanvas, sigCtx, sigDrawing = false, sigHasDrawn = false;

    document.addEventListener('DOMContentLoaded', () => {
      initSignaturePad();
      fetchEmployees();
      setupListeners();
    });

    // =========================
    // Employees
    // =========================
    async function fetchEmployees() {
      const select = document.getElementById('employeeSelect');
      try {
        const res = await fetch(`${GAS_URL}?action=getEmployees`);
        const json = await res.json();

        if (!json.success) throw new Error(json.message || '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

        EMPLOYEES = json.data || [];
        EMP_MAP = {};
        select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô --</option>';

        EMPLOYEES.forEach(emp => {
          EMP_MAP[emp.id] = emp;
          const opt = document.createElement('option');
          opt.value = emp.id;
          opt.textContent = emp.name;
          select.appendChild(opt);
        });

        select.disabled = false;
      } catch (err) {
        console.error(err);
        select.innerHTML = '<option value="">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>';
        showNotification('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + err.message, true);
      }
    }

    function toDateInputValue(value) {
      if (!value) return '';
      try {
        const d = (value instanceof Date) ? value : new Date(value);
        if (isNaN(d.getTime())) return '';
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        return `${yyyy}-${mm}-${dd}`;
      } catch (e) {
        return '';
      }
    }

    function handleEmployeeChange() {
      const id = document.getElementById('employeeSelect').value;
      const emp = EMP_MAP[id];

      const empCodeInput   = document.getElementById('empCode');
      const startDateInput = document.getElementById('startDate');
      const positionInput  = document.getElementById('currentPosition');
      const deptInput      = document.getElementById('dept');
      const divisionInput  = document.getElementById('division');
      const empTypeInput   = document.getElementById('employmentType');

      if (!emp) {
        empCodeInput.value   = '';
        startDateInput.value = '';
        positionInput.value  = '';
        deptInput.value      = '';
        divisionInput.value  = '';
        empTypeInput.value   = '';
        return;
      }

      empCodeInput.value   = emp.code || '';
      startDateInput.value = toDateInputValue(emp.startDate);
      positionInput.value  = emp.position || '';
      deptInput.value      = emp.department || '';
      divisionInput.value  = emp.division || '';
      empTypeInput.value   = emp.employmentType || '';
    }

    // =========================
    // Signature pad
    // =========================
    function initSignaturePad() {
      sigCanvas = document.getElementById('signaturePad');
      resizeSignatureCanvas();

      sigCtx = sigCanvas.getContext('2d');
      sigCtx.strokeStyle = '#111827';
      sigCtx.lineWidth = 1.6;
      sigCtx.lineCap = 'round';

      sigCanvas.addEventListener('mousedown', startDraw);
      sigCanvas.addEventListener('mousemove', draw);
      window.addEventListener('mouseup', endDraw);

      sigCanvas.addEventListener('touchstart', startDraw, { passive: false });
      sigCanvas.addEventListener('touchmove', draw, { passive: false });
      window.addEventListener('touchend', endDraw);
      window.addEventListener('resize', () => {
        // ‡∏ñ‡πâ‡∏≤ resize ‡∏à‡∏∞‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏∏‡∏î)
        resizeSignatureCanvas();
        sigHasDrawn = false;
      });
    }

    function resizeSignatureCanvas() {
      const rect = sigCanvas.getBoundingClientRect();
      sigCanvas.width = rect.width * window.devicePixelRatio;
      sigCanvas.height = 160 * window.devicePixelRatio;
      const ctx = sigCanvas.getContext('2d');
      ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, rect.width, 160);
    }

    function getPointerPos(e) {
      const rect = sigCanvas.getBoundingClientRect();
      let clientX, clientY;
      if (e.touches && e.touches.length > 0) {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }
      return {
        x: clientX - rect.left,
        y: clientY - rect.top
      };
    }

    function startDraw(e) {
      e.preventDefault();
      sigDrawing = true;
      sigHasDrawn = true;
      const p = getPointerPos(e);
      sigCtx.beginPath();
      sigCtx.moveTo(p.x, p.y);
    }

    function draw(e) {
      if (!sigDrawing) return;
      e.preventDefault();
      const p = getPointerPos(e);
      sigCtx.lineTo(p.x, p.y);
      sigCtx.stroke();
    }

    function endDraw() {
      if (!sigDrawing) return;
      sigDrawing = false;
    }

    function clearSignature() {
      if (!sigCanvas || !sigCtx) return;
      const rect = sigCanvas.getBoundingClientRect();
      sigCtx.clearRect(0, 0, rect.width, 160);
      sigCtx.fillStyle = '#ffffff';
      sigCtx.fillRect(0, 0, rect.width, 160);
      sigHasDrawn = false;
    }

    function getSignatureData() {
      if (!sigHasDrawn) return '';
      return sigCanvas.toDataURL('image/png');
    }

    // =========================
    // Actions / details
    // =========================
    function handleActionChange(e) {
      const selected = e.target;
      if (selected.name !== 'actionType') return;

      const detailInputs = document.querySelectorAll('.action-detail-input');
      detailInputs.forEach(inp => {
        inp.disabled = true;
      });

      const detailId = 'detail-' + selected.value;
      const target = document.getElementById(detailId);
      if (target) {
        target.disabled = false;
        target.focus();
      }
    }

    // =========================
    // Submit
    // =========================
    async function handleSubmit(e) {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;

      try {
        const empId = document.getElementById('employeeSelect').value;
        const emp   = EMP_MAP[empId] || {};

        if (!empId) {
          throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô');
        }

        const actionRadio = document.querySelector('input[name="actionType"]:checked');
        if (!actionRadio) {
          throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
        }

        const actionType  = actionRadio.value;
        const actionLabel = actionRadio.dataset.label || actionType;
        const detailInput = document.getElementById('detail-' + actionType);
        const actionDetail = detailInput ? detailInput.value.trim() : '';

        const formData = {
          empCode:        document.getElementById('empCode').value.trim(),
          empName:        emp.name || '',
          empPosition:    document.getElementById('currentPosition').value.trim(),
          empDepartment:  document.getElementById('dept').value.trim(),
          empDivision:    document.getElementById('division').value.trim(),
          company:        emp.company || '',
          employmentType: document.getElementById('employmentType').value.trim(),
          empEmail:       emp.email || '',
          startDate:      document.getElementById('startDate').value || '',
          effectiveDate:  document.getElementById('effectiveDate').value || '',
          details:        document.getElementById('extraDetail').value.trim(),
          actionType:     actionType,
          actionLabel:    actionLabel,
          actionDetail:   actionDetail,
          proposerSignature: getSignatureData()
        };

        const res = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'createDocument',
            formData: formData
          })
        });

        const json = await res.json();

        if (!json.success) {
          throw new Error(json.message || '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }

        showNotification(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ${json.docNumber || ''}`, false);

        // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≤ ‡πÜ (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô)
        document.getElementById('extraDetail').value = '';
        document.getElementById('effectiveDate').value = '';
        clearSignature();
      } catch (err) {
        console.error(err);
        showNotification(err.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', true);
      } finally {
        submitBtn.disabled = false;
      }
    }

    // =========================
    // Utils / listeners
    // =========================
    function setupListeners() {
      document.getElementById('employeeSelect').addEventListener('change', handleEmployeeChange);
      document.getElementById('actionForm').addEventListener('submit', handleSubmit);
      document.addEventListener('change', handleActionChange);
    }

    function showNotification(message, isError) {
      const el = document.getElementById('notification');
      el.textContent = message;
      el.classList.toggle('error', !!isError);
      el.classList.add('show');
      setTimeout(() => {
        el.classList.remove('show');
      }, 3500);
    }

    function goBack() {
      if (document.referrer) {
        window.history.back();
      } else {
        window.location.href = 'index.html';
      }
    }
  </script>
</body>
</html>
