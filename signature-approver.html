<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ - The Carpetmaker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --purple-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --text-dark: #1f2933;
      --text-light: #7b8794;
      --border: #e1e7ef;
      --section-border: #4f46e5;
      --success: #10b981;
      --danger: #ef4444;
    }

    body {
      font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--purple-gradient);
      min-height: 100vh;
      padding: 32px 16px;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
      color: #fff;
    }

    .header-title {
      font-size: 28px;
      font-weight: 700;
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
    }

    .header-subtitle {
      margin-top: 4px;
      font-size: 14px;
      opacity: 0.9;
    }

    .content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .card {
      background: #fff;
      border-radius: 20px;
      padding: 24px 28px 28px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.35);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: var(--purple-gradient);
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 16px;
    }

    .section {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 18px 18px;
      margin-bottom: 14px;
      background: #f9fafb;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .section-bar {
      width: 4px;
      height: 20px;
      border-radius: 999px;
      background: var(--section-border);
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-dark);
    }

    .field-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 10px 18px;
    }

    .field {
      font-size: 13px;
    }

    .field-label {
      font-size: 12px;
      color: var(--text-light);
      margin-bottom: 3px;
    }

    .field-value-box {
      min-height: 34px;
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 6px 10px;
      background: #fff;
      display: flex;
      align-items: center;
      font-size: 13px;
      color: var(--text-dark);
      white-space: pre-wrap;
    }

    .status-msg {
      font-size: 13px;
      padding: 8px 10px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 12px;
      background: #eff6ff;
      color: #1d4ed8;
    }
    .status-msg.error {
      background: #fef2f2;
      color: #b91c1c;
    }
    .status-msg.success {
      background: #ecfdf5;
      color: #047857;
    }

    /* ===== ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ===== */

    .operation-note {
      font-size: 12px;
      color: var(--text-light);
      margin-bottom: 8px;
    }

    .operation-row {
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 4px 10px;
      padding: 4px 0;
    }

    .operation-left {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      font-size: 13px;
      color: var(--text-dark);
      min-width: 140px;
    }

    .operation-left input[type="radio"] {
      margin-top: 3px;
    }

    .operation-right {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .op-line {
      display: flex;
      align-items: flex-end;
      gap: 6px;
    }

    .op-label {
      font-size: 13px;
      color: var(--text-dark);
      white-space: nowrap;
    }

    .readonly-line {
      display: inline-block;
      flex: 1;
      min-height: 18px;
      border-bottom: 1px solid #cbd5e1;
      padding: 0 4px 2px;
      font-size: 13px;
      color: var(--text-dark);
      line-height: 1.3;
      vertical-align: bottom;
    }

    .operation-detail-wrapper {
      margin-top: 10px;
      font-size: 13px;
    }

    .operation-detail-label {
      margin-bottom: 4px;
      color: var(--text-light);
    }

    .textarea-box {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 8px 10px;
      background: #ffffff;
      min-height: 80px;
      font-size: 13px;
      color: var(--text-dark);
      white-space: pre-wrap;
    }

    /* ===== ‡∏ù‡∏±‡πà‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô ‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ===== */

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      background: #fef3c7;
      color: #92400e;
      margin-bottom: 12px;
    }

    .signature-pad {
      border: 2px dashed var(--border);
      border-radius: 10px;
      background: #ffffff;
      cursor: crosshair;
      display: block;
      width: 100%;
      margin: 8px 0 12px;
    }

    .btn-row {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }

    .btn {
      flex: 1;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-clear {
      background: #e5e7eb;
      color: #374151;
    }
    .btn-clear:hover {
      background: #d1d5db;
    }

    .btn-save {
      background: var(--success);
      color: #ffffff;
      box-shadow: 0 4px 14px rgba(16, 185, 129, 0.35);
    }
    .btn-save:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(16, 185, 129, 0.45);
    }

    .btn-approve {
      background: var(--success);
      color: #ffffff;
      flex: 1;
      box-shadow: 0 4px 14px rgba(16, 185, 129, 0.35);
    }
    .btn-approve:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(16, 185, 129, 0.45);
    }

    .btn-reject {
      background: var(--danger);
      color: #ffffff;
      flex: 1;
      box-shadow: 0 4px 14px rgba(239, 68, 68, 0.35);
    }
    .btn-reject:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(239, 68, 68, 0.45);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .info-item {
      padding: 10px 12px;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px solid #edf2f7;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .info-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .04em;
      color: var(--text-light);
      margin-bottom: 2px;
    }

    .signature-history {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px dashed var(--border);
      font-size: 12px;
      color: var(--text-light);
    }

    .signature-item {
      margin-bottom: 6px;
    }

    .signature-item strong {
      color: var(--text-dark);
    }

    .success-message {
      display: none;
      padding: 12px;
      background: #d1fae5;
      border-radius: 8px;
      color: #065f46;
      text-align: center;
      font-weight: 600;
      margin-top: 12px;
      font-size: 13px;
    }

    .success-message.show { display: block; }

    /* ===== Modal Dialog ===== */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.3s ease;
    }

    .modal.show { display: flex; }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background-color: white;
      margin: auto;
      padding: 28px;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-body {
      margin-bottom: 20px;
      color: var(--text-dark);
      font-size: 14px;
      line-height: 1.6;
    }

    .modal-input-group {
      margin-bottom: 16px;
    }

    .modal-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-dark);
      margin-bottom: 6px;
      display: block;
    }

    .modal-textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: inherit;
      font-size: 13px;
      resize: vertical;
      min-height: 80px;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .btn-modal {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-cancel {
      background: #e5e7eb;
      color: #374151;
    }
    .btn-cancel:hover {
      background: #d1d5db;
    }

    .btn-confirm {
      background: var(--success);
      color: white;
    }
    .btn-confirm:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .btn-confirm.reject {
      background: var(--danger);
    }
    .btn-confirm.reject:hover {
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    @media (max-width: 900px) {
      .content { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="header-title">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h1>
      <p class="header-subtitle" id="headerSubtitle">The Carpetmaker Co., Ltd.</p>
    </div>

    <div class="content">
      <!-- ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ + ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
      <div class="card">
        <div class="card-title">üìÑ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>

        <div id="status" class="status-msg">
          ‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö...
        </div>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
        <div class="section">
          <div class="section-header">
            <div class="section-bar"></div>
            <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
          </div>

          <div class="field-grid">
            <div class="field">
              <div class="field-label">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
              <div class="field-value-box" id="empName">-</div>
            </div>
            <div class="field">
              <div class="field-label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô / ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>
              <div class="field-value-box" id="empCodePos">-</div>
            </div>
            <div class="field">
              <div class="field-label">‡πÅ‡∏ú‡∏ô‡∏Å / ‡∏ù‡πà‡∏≤‡∏¢</div>
              <div class="field-value-box" id="dept">-</div>
            </div>
            <div class="field">
              <div class="field-label">‡∏™‡∏†‡∏≤‡∏û‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô / ‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</div>
              <div class="field-value-box" id="employmentStatus">-</div>
            </div>
          </div>
        </div>

        <!-- ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
        <div class="section">
          <div class="section-header">
            <div class="section-bar"></div>
            <div class="section-title">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
          </div>

          <div class="operation-note">
            * ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
          </div>

          <!-- ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_appoint" disabled>
              <label for="action_appoint">‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡πÄ‡∏õ‡πá‡∏ô</span>
                <span class="readonly-line" id="appoint_to"></span>
              </div>
            </div>
          </div>

          <!-- ‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢ -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_transfer" disabled>
              <label for="action_transfer">‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°</span>
                <span class="readonly-line" id="transfer_from"></span>
              </div>
              <div class="op-line">
                <span class="op-label">‡πÄ‡∏õ‡πá‡∏ô</span>
                <span class="readonly-line" id="transfer_to"></span>
              </div>
            </div>
          </div>

          <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_change" disabled>
              <label for="action_change">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°</span>
                <span class="readonly-line" id="change_from"></span>
              </div>
              <div class="op-line">
                <span class="op-label">‡πÄ‡∏õ‡πá‡∏ô</span>
                <span class="readonly-line" id="change_to"></span>
              </div>
            </div>
          </div>

          <!-- ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_promote" disabled>
              <label for="action_promote">‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°</span>
                <span class="readonly-line" id="promote_from"></span>
              </div>
              <div class="op-line">
                <span class="op-label">‡πÄ‡∏õ‡πá‡∏ô</span>
                <span class="readonly-line" id="promote_to"></span>
              </div>
            </div>
          </div>

          <!-- ‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_passProb" disabled>
              <label for="action_passProb">‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡πÄ‡∏õ‡πá‡∏ô</span>
                <span class="readonly-line" id="passProb_to"></span>
              </div>
            </div>
          </div>

          <!-- ‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô / ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_terminate" disabled>
              <label for="action_terminate">‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô / ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
                <span class="readonly-line" id="terminate_detail"></span>
              </div>
            </div>
          </div>

          <!-- ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_raise" disabled>
              <label for="action_raise">‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°</span>
                <span class="readonly-line" id="raise_from"></span>
              </div>
              <div class="op-line">
                <span class="op-label">‡πÄ‡∏õ‡πá‡∏ô</span>
                <span class="readonly-line" id="raise_to"></span>
              </div>
            </div>
          </div>

          <!-- ‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_cut" disabled>
              <label for="action_cut">‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°</span>
                <span class="readonly-line" id="cut_from"></span>
              </div>
              <div class="op-line">
                <span class="op-label">‡πÄ‡∏õ‡πá‡∏ô</span>
                <span class="readonly-line" id="cut_to"></span>
              </div>
            </div>
          </div>

          <!-- ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ -->
          <div class="operation-row">
            <div class="operation-left">
              <input type="radio" name="actionType" id="action_other" disabled>
              <label for="action_other">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</label>
            </div>
            <div class="operation-right">
              <div class="op-line">
                <span class="op-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
                <span class="readonly-line" id="other_detail"></span>
              </div>
            </div>
          </div>

          <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î & ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏• -->
          <div class="operation-detail-wrapper">
            <div class="operation-detail-label">
              ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° / ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á
            </div>
            <div class="textarea-box" id="detailText">-</div>
          </div>

          <div class="operation-detail-wrapper" style="margin-top:8px;">
            <div class="operation-detail-label">‡∏°‡∏µ‡∏ú‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
            <div class="readonly-line" id="effectiveDate"></div>
          </div>
        </div>
      </div>

      <!-- ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤: ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
      <div class="card">
        <div class="card-title">‚úçÔ∏è ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>

        <div class="status-badge" id="statusBadge">‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>

        <canvas id="signaturePad" class="signature-pad" height="170"></canvas>

        <div class="btn-row">
          <button type="button" class="btn btn-clear" id="btnClear">‚úï ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
          <button type="button" class="btn btn-save" id="btnSave">‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ / ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
        <div class="btn-row">
          <button type="button" class="btn btn-approve" id="btnApprove">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
          <button type="button" class="btn btn-reject" id="btnReject">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
        </div>

        <div class="info-item">
          <div class="info-label">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</div>
          <div>‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</div>
        </div>

        <div class="info-item">
          <div class="info-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
          <div id="approverName">‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</div>
        </div>

        <div class="signature-history">
          <div class="signature-item" id="historyStep1">‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠: -</div>
          <div class="signature-item" id="historyStep2">‡∏ú‡∏π‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô: -</div>
        </div>

        <div class="success-message" id="successMessage">
          ‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏ã‡πá‡∏ô‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
        </div>
      </div>
    </div>
  </div>

  <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
  <div id="approveModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
      </div>
      <div class="modal-body">
        ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö <strong id="modalEmpName">-</strong> 
        <br><br>
        ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-modal btn-cancel" id="btnApproveCancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="button" class="btn-modal btn-confirm" id="btnApproveConfirm">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
      </div>
    </div>
  </div>

  <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
  <div id="rejectModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
      </div>
      <div class="modal-body">
        <p>‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö <strong id="modalEmpNameReject">-</strong></p>
        <p style="color: var(--danger); font-weight: 600; margin-top: 12px;">
          ‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠
        </p>
      </div>
      <div class="modal-input-group">
        <label class="modal-label">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</label>
        <textarea id="rejectReason" class="modal-textarea" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥..."></textarea>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-modal btn-cancel" id="btnRejectCancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button type="button" class="btn-modal btn-confirm reject" id="btnRejectConfirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
      </div>
    </div>
  </div>

  <script>
    const WEB_APP_URL =
      'https://script.google.com/macros/s/AKfycbxe3OSwY-ko4E3qvVSyFQQ1W7OCZjufP-VmFT3LxPqFMwf_y8LO9A8cxFJjMvHvdj7ksQ/exec';
    const ROLE = 'approver';

    let DOC_NO = '';
    let hasSignature = false;
    let isSubmitting = false;
    let currentDecision = null; // 'approve' ‡∏´‡∏£‡∏∑‡∏≠ 'reject'

    function getQueryParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name) || '';
    }

    function formatDateShort(dateStr) {
      if (!dateStr) return '-';
      const d = new Date(dateStr);
      if (isNaN(d.getTime())) return dateStr;
      const day   = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year  = d.getFullYear();
      return `${day}/${month}/${year}`;
    }

    function formatDateTime(dt) {
      if (!dt) return '-';
      const d = new Date(dt);
      if (isNaN(d.getTime())) return dt;
      return d.toLocaleString('th-TH');
    }

    function cleanupJSONP(cbName) {
      const scripts = document.getElementsByTagName('script');
      for (let i = scripts.length - 1; i >= 0; i--) {
        if (scripts[i].src && scripts[i].src.includes(cbName)) {
          scripts[i].parentNode.removeChild(scripts[i]);
        }
      }
      try { delete window[cbName]; } catch (e) {}
    }

    // ===== renderOperationData =====
    function renderOperationData(data) {
      console.log('approver render data:', data);

      const empName =
        data['‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'] ||
        data['‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'] ||
        data['employeeName'] ||
        '-';
      document.getElementById('empName').textContent = empName;
      document.getElementById('modalEmpName').textContent = empName;
      document.getElementById('modalEmpNameReject').textContent = empName;

      const empCode = data['‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'] || '';
      const empPos  = data['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'] || '';
      const codePos =
        data['‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'] ||
        data['empCodePosition'] ||
        '';

      document.getElementById('empCodePos').textContent =
        codePos ||
        (empCode && empPos
          ? `${empCode} / ${empPos}`
          : (empCode || empPos || '-'));

      const deptOnly  = data['‡πÅ‡∏ú‡∏ô‡∏Å'] || '';
      const divOnly   = data['‡∏ù‡πà‡∏≤‡∏¢'] || '';
      const deptCombo =
        data['‡πÅ‡∏ú‡∏ô‡∏Å/‡∏ù‡πà‡∏≤‡∏¢'] ||
        data['department'] ||
        '';

      document.getElementById('dept').textContent =
        deptCombo ||
        (deptOnly || divOnly
          ? [deptOnly, divOnly].filter(Boolean).join(' / ')
          : '-');

      const empStatus =
        data['‡∏™‡∏†‡∏≤‡∏û‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô/‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô'] ||
        data['employmentStatus'] ||
        data['‡∏™‡∏†‡∏≤‡∏û‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô'] ||
        '';
      document.getElementById('employmentStatus').textContent =
        empStatus || '-';

      // ===== ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ =====
      const actionType =
        data['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'] ||
        data['‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'] ||
        data['actionType'] ||
        '';

      const opDetail = data['‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'] || '';

      const radioMap = {
        '‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á': 'action_appoint',
        '‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢': 'action_transfer',
        '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô': 'action_change',
        '‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á': 'action_promote',
        '‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô': 'action_passProb',
        '‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à / ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å': 'action_terminate',
        '‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à / ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å': 'action_terminate',
        '‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à/‡∏•‡∏≤‡∏≠‡∏≠‡∏Å': 'action_terminate',
        '‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô / ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å': 'action_terminate',
        '‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': 'action_raise',
        '‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á/‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': 'action_raise',
        '‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': 'action_cut',
        '‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á/‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': 'action_cut',
        '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ': 'action_other',
        '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': 'action_other'
      };

      const radioId = radioMap[actionType];
      if (radioId) {
        const r = document.getElementById(radioId);
        if (r) r.checked = true;
      }

      const globalFrom =
        data['‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏° (From)'] ||
        data['actionFrom'] ||
        '';
      const globalTo =
        data['‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà (To)'] ||
        data['actionTo'] ||
        '';

      switch (actionType) {
        case '‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á':
          document.getElementById('appoint_to').textContent =
            globalTo ||
            data['‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á_‡πÄ‡∏õ‡πá‡∏ô'] ||
            opDetail ||
            '';
          break;

        case '‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢': {
          const fromCol = globalFrom || data['‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢_‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°'] || '';
          const toCol = globalTo || data['‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢_‡πÄ‡∏õ‡πá‡∏ô'] || '';

          if (fromCol || toCol) {
            document.getElementById('transfer_from').textContent = fromCol;
            document.getElementById('transfer_to').textContent   = toCol;
          } else if (opDetail) {
            const m = opDetail.match(/‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°\s*(.+?)\s*‡πÄ‡∏õ‡πá‡∏ô\s*(.+)/);
            document.getElementById('transfer_from').textContent =
              m && m[1] ? m[1].trim() : opDetail;
            document.getElementById('transfer_to').textContent =
              m && m[2] ? m[2].trim() : '';
          }
          break;
        }

        case '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô': {
          const fromCol = globalFrom || data['‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û_‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°'] || '';
          const toCol = globalTo || data['‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏†‡∏≤‡∏û_‡πÄ‡∏õ‡πá‡∏ô'] || '';

          document.getElementById('change_from').textContent = fromCol || opDetail || '';
          document.getElementById('change_to').textContent = toCol;
          break;
        }

        case '‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á': {
          const fromCol = globalFrom || data['‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á_‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°'] || '';
          const toCol = globalTo || data['‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á_‡πÄ‡∏õ‡πá‡∏ô'] || '';

          document.getElementById('promote_from').textContent = fromCol || opDetail || '';
          document.getElementById('promote_to').textContent = toCol;
          break;
        }

        case '‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô':
          document.getElementById('passProb_to').textContent =
            globalTo || data['‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô_‡πÄ‡∏õ‡πá‡∏ô'] || opDetail || '';
          break;

        case '‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à / ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å':
        case '‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à / ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å':
        case '‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à/‡∏•‡∏≤‡∏≠‡∏≠‡∏Å':
        case '‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô / ‡∏•‡∏≤‡∏≠‡∏≠‡∏Å':
          document.getElementById('terminate_detail').textContent =
            opDetail || data['‡πÉ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô_‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'] || '';
          break;

        case '‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô':
        case '‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á/‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': {
          const fromCol = globalFrom || data['‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á_‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°'] || '';
          const toCol = globalTo || data['‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á_‡πÄ‡∏õ‡πá‡∏ô'] || '';

          document.getElementById('raise_from').textContent = fromCol || opDetail || '';
          document.getElementById('raise_to').textContent = toCol;
          break;
        }

        case '‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á / ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô':
        case '‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á/‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': {
          const fromCol = globalFrom || data['‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á_‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏°'] || '';
          const toCol = globalTo || data['‡∏ï‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á_‡πÄ‡∏õ‡πá‡∏ô'] || '';

          document.getElementById('cut_from').textContent = fromCol || opDetail || '';
          document.getElementById('cut_to').textContent = toCol;
          break;
        }

        case '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ':
        case '‡∏≠‡∏∑‡πà‡∏ô‡πÜ':
          document.getElementById('other_detail').textContent =
            opDetail || data['‡∏≠‡∏∑‡πà‡∏ô‡πÜ_‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'] || '';
          break;
      }

      document.getElementById('detailText').textContent =
        data['‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'] || data['detail'] || '-';

      const effRaw =
        data['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•'] ||
        data['‡∏°‡∏µ‡∏ú‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'] ||
        data['effectiveDate'] ||
        '';

      document.getElementById('effectiveDate').textContent = formatDateShort(effRaw);
    }

    // ===== ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ =====
    function loadDocInfo() {
      const statusEl = document.getElementById('status');

      DOC_NO =
        getQueryParam('docNo') ||
        getQueryParam('id') ||
        getQueryParam('row') ||
        '';

      if (!DOC_NO) {
        document.getElementById('headerSubtitle').textContent =
          '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (docNo/id/row)';
        if (statusEl) {
          statusEl.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå';
          statusEl.classList.add('error');
        }
        return;
      }

      document.getElementById('headerSubtitle').textContent =
        `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: ${DOC_NO}`;

      const cbName = 'docAp_' + Date.now();
      const script = document.createElement('script');
      script.src =
        `${WEB_APP_URL}?action=getDoc&docNo=${encodeURIComponent(DOC_NO)}&callback=${cbName}`;

      window[cbName] = function(res) {
        if (!res || !res.success) {
          if (statusEl) {
            statusEl.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
            statusEl.classList.add('error');
          }
          cleanupJSONP(cbName);
          return;
        }

        const doc = res.data || {};
        const opData =
          doc.operationData ||
          doc.row ||
          doc ||
          {};

        renderOperationData(opData);

        if (statusEl) {
          statusEl.textContent = '‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
          statusEl.classList.add('success');
          setTimeout(() => (statusEl.style.display = 'none'), 2500);
        }

        const steps = doc.steps || [];

        if (steps[0]) {
          document.getElementById('historyStep1').textContent =
            `‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠: ${steps[0].name || '-'} (${formatDateTime(steps[0].time)})`;
        }
        if (steps[1]) {
          document.getElementById('historyStep2').textContent =
            `‡∏ú‡∏π‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô: ${steps[1].name || '-'} (${formatDateTime(steps[1].time)})`;
        }

        const approverFromParam = getQueryParam('approver') || '';
        if (approverFromParam) {
          document.getElementById('approverName').textContent = approverFromParam;
        } else if (steps[2]) {
          document.getElementById('approverName').textContent =
            steps[2].name || '‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£';
        }

        cleanupJSONP(cbName);
      };

      script.onerror = function() {
        if (statusEl) {
          statusEl.textContent = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
          statusEl.classList.add('error');
        }
        cleanupJSONP(cbName);
      };

      document.head.appendChild(script);
    }

    // ===== Signature Pad =====
    const canvas = document.getElementById('signaturePad');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;

    function resizeCanvas() {
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = 170;
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#111827';
    }

    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function startDraw(e) {
      isDrawing = true;
      hasSignature = true;
      const pos = getPos(e);
      ctx.beginPath();
      ctx.moveTo(pos.x, pos.y);
    }

    function draw(e) {
      if (!isDrawing) return;
      const pos = getPos(e);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
    }

    function stopDraw() {
      isDrawing = false;
    }

    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      hasSignature = false;
      const msg = document.getElementById('successMessage');
      if (msg) msg.classList.remove('show');
      const badge = document.getElementById('statusBadge');
      if (badge) badge.textContent = '‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
    }

    function handleSaveSignature() {
      if (!DOC_NO) {
        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£');
        return;
      }
      if (!hasSignature) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      if (isSubmitting) return;
      isSubmitting = true;

      const btnSave  = document.getElementById('btnSave');
      const btnClear = document.getElementById('btnClear');
      if (btnSave)  btnSave.disabled  = true;
      if (btnClear) btnClear.disabled = true;

      const dataUrl = canvas.toDataURL('image/png');

      const formData = new URLSearchParams();
      formData.append('action', 'saveSignature');
      formData.append('docNo', DOC_NO);
      formData.append('role', ROLE);
      formData.append('signature', dataUrl);

      fetch(WEB_APP_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      }).then(() => {
        const successMessage = document.getElementById('successMessage');
        if (successMessage) successMessage.classList.add('show');

        const statusBadge = document.getElementById('statusBadge');
        if (statusBadge) statusBadge.textContent = '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß';

        setTimeout(() => {
          alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }, 600);
      }).catch(err => {
        console.error(err);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
      }).finally(() => {
        isSubmitting = false;
        if (btnSave)  btnSave.disabled  = false;
        if (btnClear) btnClear.disabled = false;
      });
    }

    // ===== Modal Functions =====
    function showApproveModal() {
      if (!hasSignature) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      document.getElementById('approveModal').classList.add('show');
    }

    function hideApproveModal() {
      document.getElementById('approveModal').classList.remove('show');
    }

    function showRejectModal() {
      if (!hasSignature) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      document.getElementById('rejectModal').classList.add('show');
    }

    function hideRejectModal() {
      document.getElementById('rejectModal').classList.remove('show');
      document.getElementById('rejectReason').value = '';
    }

    function submitDecision(decision) {
      if (!DOC_NO) {
        alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£');
        return;
      }
      if (!hasSignature) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      if (isSubmitting) return;
      isSubmitting = true;

      // ‡∏ã‡πà‡∏≠‡∏ô modal
      if (decision === 'approve') hideApproveModal();
      if (decision === 'reject') hideRejectModal();

      const dataUrl = canvas.toDataURL('image/png');
      const reason = decision === 'reject' ? document.getElementById('rejectReason').value : '';

      const formData = new URLSearchParams();
      formData.append('action', 'saveSignature');
      formData.append('docNo', DOC_NO);
      formData.append('role', ROLE);
      formData.append('signature', dataUrl);
      formData.append('decision', decision);
      formData.append('reason', reason);

      fetch(WEB_APP_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: formData
      }).then(() => {
        const statusBadge = document.getElementById('statusBadge');
        if (decision === 'approve') {
          const successMessage = document.getElementById('successMessage');
          if (successMessage) {
            successMessage.textContent = '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏ã‡πá‡∏ô‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö';
            successMessage.classList.add('show');
          }
          if (statusBadge) statusBadge.textContent = '‚úì ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
        } else {
          const successMessage = document.getElementById('successMessage');
          if (successMessage) {
            successMessage.textContent = '‚úÖ ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏£‡∏≤‡∏ö';
            successMessage.style.background = '#fee2e2';
            successMessage.style.color = '#991b1b';
            successMessage.classList.add('show');
          }
          if (statusBadge) statusBadge.textContent = '‚úó ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
          if (statusBadge) statusBadge.style.background = '#fee2e2';
          if (statusBadge) statusBadge.style.color = '#991b1b';
        }

        setTimeout(() => {
          alert(decision === 'approve' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß' : '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
        }, 600);
      }).catch(err => {
        console.error(err);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
      }).finally(() => {
        isSubmitting = false;
      });
    }

    // ===== Init =====
    window.addEventListener('DOMContentLoaded', () => {
      resizeCanvas();
      loadDocInfo();

      canvas.addEventListener('mousedown', startDraw);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDraw);
      canvas.addEventListener('mouseleave', stopDraw);

      canvas.addEventListener('touchstart', e => { e.preventDefault(); startDraw(e); }, { passive: false });
      canvas.addEventListener('touchmove',  e => { e.preventDefault(); draw(e); },      { passive: false });
      canvas.addEventListener('touchend',   e => { e.preventDefault(); stopDraw(e); },  { passive: false });

      document.getElementById('btnClear').addEventListener('click', clearSignature);
      document.getElementById('btnSave').addEventListener('click', handleSaveSignature);

      // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ / ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
      document.getElementById('btnApprove').addEventListener('click', showApproveModal);
      document.getElementById('btnReject').addEventListener('click', showRejectModal);

      // Modal Approve
      document.getElementById('btnApproveCancel').addEventListener('click', hideApproveModal);
      document.getElementById('btnApproveConfirm').addEventListener('click', () => submitDecision('approve'));

      // Modal Reject
      document.getElementById('btnRejectCancel').addEventListener('click', hideRejectModal);
      document.getElementById('btnRejectConfirm').addEventListener('click', () => submitDecision('reject'));

      // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å modal backdrop
      document.getElementById('approveModal').addEventListener('click', (e) => {
        if (e.target.id === 'approveModal') hideApproveModal();
      });
      document.getElementById('rejectModal').addEventListener('click', (e) => {
        if (e.target.id === 'rejectModal') hideRejectModal();
      });
    });

    window.addEventListener('resize', resizeCanvas);
  </script>
</body>
</html>