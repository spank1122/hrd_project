<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏•‡∏á‡∏ô‡∏≤‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ - The Carpetmaker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Sarabun -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: #f4f4fb;
      --card-bg: #ffffff;
      --primary: #4f46e5;
      --primary-soft: #eef2ff;
      --danger: #dc2626;
      --text-main: #111827;
      --text-sub: #6b7280;
      --border: #e5e7eb;
      --shadow: 0 16px 40px rgba(15, 23, 42, 0.12);
      --success: #059669;
    }

    body {
      font-family: "Sarabun", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #e0e7ff, #f4f4fb 55%);
      min-height: 100vh;
      padding: 24px;
      color: var(--text-main);
    }

    .page {
      max-width: 980px;
      margin: 0 auto;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 24px 28px 28px;
      margin-bottom: 20px;
      border: 1px solid rgba(148, 163, 184, 0.16);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 12px;
    }

    .title-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title {
      font-size: 22px;
      font-weight: 600;
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 11px;
      font-weight: 600;
      padding: 3px 10px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: var(--primary);
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-sub);
    }

    .badge-status {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #374151;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #6b7280;
    }

    .badge-dot.pending {
      background: #f59e0b;
    }

    .badge-dot.approved {
      background: #10b981;
    }

    .badge-dot.rejected {
      background: #ef4444;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title::before {
      content: "";
      width: 3px;
      height: 18px;
      border-radius: 999px;
      background: var(--primary);
    }

    .section {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed var(--border);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px 20px;
      margin-top: 6px;
    }

    .field-label {
      font-size: 12px;
      color: #6b7280;
    }

    .field-value {
      font-size: 13px;
      margin-top: 1px;
    }

    .field-row {
      display: flex;
      flex-direction: column;
    }

    .field-span2 {
      grid-column: 1 / -1;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      color: #374151;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #4f46e5;
    }

    .timeline {
      margin-top: 8px;
      font-size: 12px;
      color: #4b5563;
    }

    .timeline-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      align-items: center;
    }

    .timeline-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .timeline-label {
      font-weight: 500;
    }

    .timeline-sep {
      color: #d1d5db;
    }

    /* Signature Section */
    .sign-section {
      margin-top: 10px;
      padding-top: 12px;
      border-top: 1px dashed var(--border);
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 20px;
    }

    .sign-card {
      border-radius: 14px;
      border: 1px dashed #c7d2fe;
      background: #f9fafb;
      padding: 12px 14px;
    }

    .sign-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .sign-card-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .sign-hint {
      font-size: 10px;
      color: #6b7280;
    }

    .sign-tools {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 10px;
      color: #6b7280;
    }

    .sign-tools span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .kbd {
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      padding: 1px 6px;
      font-size: 10px;
      background: #f9fafb;
    }

    .sign-canvas-wrap {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 8px;
    }

    .sign-canvas-inner {
      border-radius: 8px;
      border: 1px dashed #d1d5db;
      height: 160px;
      background:
        linear-gradient(to right, transparent 0, transparent 10px, rgba(229, 231, 235, 0.5) 11px) 0 93% / 16px 1px repeat-x,
        radial-gradient(circle at 0 100%, rgba(229, 231, 235, 0.9) 0, transparent 48%);
      position: relative;
      overflow: hidden;
    }

    #signatureCanvas {
      width: 100%;
      height: 100%;
      display: block;
      cursor: crosshair;
    }

    .sign-footer-line {
      position: absolute;
      left: 6%;
      right: 6%;
      bottom: 18px;
      border-bottom: 1px dashed rgba(107, 114, 128, 0.6);
    }

    .sign-footer-label {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 2px;
      font-size: 11px;
      color: #6b7280;
    }

    .sign-controls {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 11px;
    }

    .sign-legend {
      color: #6b7280;
    }

    .sign-buttons {
      display: flex;
      gap: 6px;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 12px;
      padding: 4px 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-family: inherit;
      transition: 0.15s ease;
      white-space: nowrap;
      background: #e5e7eb;
      color: #111827;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #ffffff;
      border-color: #4f46e5;
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.35);
    }

    .btn-primary:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-danger {
      background: #fee2e2;
      color: #b91c1c;
      border-color: #fecaca;
    }

    .btn-outline {
      background: #ffffff;
      border-color: #d1d5db;
      color: #374151;
    }

    .btn-sm {
      padding: 3px 10px;
      font-size: 11px;
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.18);
    }

    .btn:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 6px 15px rgba(15, 23, 42, 0.16);
    }

    .decision-card {
      font-size: 12px;
    }

    .decision-label {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .decision-radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }

    .radio-pill {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      cursor: pointer;
      font-size: 11px;
      color: #374151;
    }

    .radio-pill input {
      accent-color: #4f46e5;
    }

    .decision-reason {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      font-size: 12px;
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .decision-hint {
      font-size: 10px;
      color: #6b7280;
      margin-top: 4px;
    }

    .actions-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }

    #status {
      margin-top: 10px;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 8px;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #status.error {
      background: #fef2f2;
      color: #b91c1c;
      border-color: #fecaca;
    }

    #status.success {
      background: #ecfdf3;
      color: #166534;
      border-color: #bbf7d0;
    }

    #status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #3b82f6;
    }

    #status.error #status-dot {
      background: #ef4444;
    }

    #status.success #status-dot {
      background: #22c55e;
    }

    .history {
      margin-top: 6px;
      font-size: 11px;
      color: #4b5563;
    }

    .history-line {
      margin-top: 2px;
    }

    @media (max-width: 768px) {
      body {
        padding: 14px;
      }
      .card {
        padding: 18px 16px 20px;
      }
      .sign-section {
        grid-template-columns: minmax(0, 1fr);
      }
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- CARD ‡∏´‡∏•‡∏±‡∏Å -->
    <div class="card">
      <div class="header">
        <div class="title-wrap">
          <div class="title">
            ‡∏•‡∏á‡∏ô‡∏≤‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
            <span class="title-pill">Step 3 / Approver</span>
          </div>
          <div class="subtitle" id="headerSubtitle">
            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö...
          </div>
        </div>
        <div class="badge-status" id="statusBadge">
          <span class="badge-dot pending" id="badgeDot"></span>
          <span id="badgeText">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
        </div>
      </div>

      <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
      <div class="section">
        <div class="section-title">
          ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
        </div>
        <div class="grid">
          <div class="field-row">
            <div class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
            <div class="field-value" id="empName">-</div>
          </div>
          <div class="field-row">
            <div class="field-label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
            <div class="field-value" id="empCode">-</div>
          </div>

          <div class="field-row">
            <div class="field-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>
            <div class="field-value" id="empPosition">-</div>
          </div>
          <div class="field-row">
            <div class="field-label">‡∏ù‡πà‡∏≤‡∏¢ / ‡πÅ‡∏ú‡∏ô‡∏Å</div>
            <div class="field-value" id="empDept">-</div>
          </div>

          <div class="field-row">
            <div class="field-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
            <div class="field-value" id="opType">-</div>
          </div>
          <div class="field-row">
            <div class="field-label">‡∏™‡∏†‡∏≤‡∏û‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô</div>
            <div class="field-value" id="employmentType">-</div>
          </div>

          <div class="field-row field-span2">
            <div class="field-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
            <div class="field-value" id="opDetail">-</div>
          </div>

          <div class="field-row field-span2">
            <div class="field-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
            <div class="field-value" id="opExtra">-</div>
          </div>

          <div class="field-row">
            <div class="field-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•</div>
            <div class="field-value" id="effectiveDate">-</div>
          </div>

          <div class="field-row">
            <div class="field-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</div>
            <div class="field-value" id="createdAt">-</div>
          </div>
        </div>

        <div class="timeline">
          <div class="timeline-row">
            <div class="timeline-item">
              <span class="timeline-label">‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠:</span>
              <span id="historyStep1">-</span>
            </div>
            <span class="timeline-sep">‚Ä¢</span>
            <div class="timeline-item">
              <span class="timeline-label">‡∏ú‡∏π‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô:</span>
              <span id="historyStep2">-</span>
            </div>
            <span class="timeline-sep">‚Ä¢</span>
            <div class="timeline-item">
              <span class="timeline-label">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</span>
              <span id="approverName">-</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô + ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à -->
      <div class="sign-section">
        <!-- ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
        <div class="sign-card">
          <div class="sign-card-header">
            <div>
              <div class="sign-card-title">
                ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </div>
              <div class="sign-hint">
                ‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </div>
            </div>
            <div class="sign-tools">
              <span>
                <span class="kbd">‡πÄ‡∏°‡∏≤‡∏™‡πå</span> ‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ã‡πá‡∏ô
              </span>
              <span>
                <span class="kbd">‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</span> ‡πÉ‡∏ä‡πâ‡∏ô‡∏¥‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤
              </span>
            </div>
          </div>

          <div class="sign-canvas-wrap">
            <div class="sign-canvas-inner">
              <canvas id="signatureCanvas"></canvas>
              <div class="sign-footer-line"></div>
              <div class="sign-footer-label">
                ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </div>
            </div>
          </div>

          <div class="sign-controls">
            <div class="sign-legend">
              ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô:
              <span id="signStatusText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ã‡πá‡∏ô</span>
            </div>
            <div class="sign-buttons">
              <button class="btn btn-sm btn-outline" id="btnClearSign" type="button">
                ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
              </button>
            </div>
          </div>
        </div>

        <!-- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
        <div class="sign-card decision-card">
          <div class="sign-card-header">
            <div class="sign-card-title">
              ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à
            </div>
          </div>

          <div>
            <div class="decision-label">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
            <div class="decision-radio-group">
              <label class="radio-pill">
                <input type="radio" name="decision" value="approve" checked>
                ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </label>
              <label class="radio-pill">
                <input type="radio" name="decision" value="reject">
                ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
              </label>
            </div>
          </div>

          <div style="margin-top: 6px;">
            <div class="decision-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ / ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï)</div>
            <textarea id="decisionReason" class="decision-reason" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏´‡∏≤‡∏Å‡∏°‡∏µ)"></textarea>
            <div class="decision-hint">
              ‚Ä¢ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äú‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‚Äù ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô<br>
              ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            </div>
          </div>

          <div class="actions-row">
            <button type="button" class="btn btn-danger" id="btnReject">
              ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            </button>
            <button type="button" class="btn btn-primary" id="btnApprove">
              ‡∏•‡∏á‡∏ô‡∏≤‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            </button>
          </div>

          <div id="status">
            <div id="status-dot"></div>
            <span id="statusText">‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏ô‡∏≤‡∏°</span>
          </div>

          <div class="history">
            <div class="history-line" id="historyInfo"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /*************************************************
     * CONFIG
     *************************************************/
    // üîπ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Web App URL ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Apps Script ‡∏à‡∏£‡∏¥‡∏á
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxe3OSwY-ko4E3qvVSyFQQ1W7OCZjufP-VmFT3LxPqFMwf_y8LO9A8cxFJjMvHvdj7ksQ/exec';

    // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏° action ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á
    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö doGet/doPost ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
    const ACTION_GET_DOC = 'getDoc';
    const ACTION_APPROVE = 'approveDoc'; // ‡∏≠‡∏ô‡∏∏‡∏°‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠, ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Apps Script
    const ACTION_REJECT = 'rejectDoc';   // ‡∏≠‡∏ô‡∏∏‡∏°‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠, ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Apps Script

    let DOC_NO = '';
    let hasSignature = false;
    let isSubmitting = false;

    /*************************************************
     * UTIL
     *************************************************/
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name) || '';
    }

    function cleanupJSONP(callbackName) {
      try {
        delete window[callbackName];
      } catch (e) {
        window[callbackName] = undefined;
      }
      const script = document.getElementById(callbackName);
      if (script && script.parentNode) {
        script.parentNode.removeChild(script);
      }
    }

    function formatDateTime(value) {
      if (!value) return '-';
      try {
        // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á ISO string ‡πÅ‡∏•‡∏∞ timestamp
        let d;
        if (typeof value === 'string') {
          d = new Date(value);
        } else {
          d = new Date(Number(value));
        }
        if (isNaN(d.getTime())) return value;

        const dd = String(d.getDate()).padStart(2, '0');
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const yyyy = d.getFullYear();
        const hh = String(d.getHours()).padStart(2, '0');
        const mi = String(d.getMinutes()).padStart(2, '0');

        return `${dd}/${mm}/${yyyy} ${hh}:${mi}`;
      } catch (e) {
        return value;
      }
    }

    function setStatus(message, type) {
      const statusEl = document.getElementById('status');
      const statusText = document.getElementById('statusText');
      if (!statusEl || !statusText) return;

      statusEl.classList.remove('error', 'success');
      if (type === 'error') statusEl.classList.add('error');
      if (type === 'success') statusEl.classList.add('success');
      statusText.textContent = message || '';

      if (type === 'success') {
        setTimeout(() => {
          statusEl.style.opacity = '0.95';
        }, 200);
      }
    }

    function setBadge(status) {
      const badgeDot = document.getElementById('badgeDot');
      const badgeText = document.getElementById('badgeText');
      if (!badgeDot || !badgeText) return;

      badgeDot.classList.remove('pending', 'approved', 'rejected');

      if (!status || status === 'pending' || status === 'pending_reviewer' || status === 'pending_approver') {
        badgeDot.classList.add('pending');
        badgeText.textContent = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
      } else if (status === 'approved') {
        badgeDot.classList.add('approved');
        badgeText.textContent = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
      } else if (status === 'rejected') {
        badgeDot.classList.add('rejected');
        badgeText.textContent = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
      } else {
        badgeDot.classList.add('pending');
        badgeText.textContent = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${status}`;
      }
    }

    /*************************************************
     * RENDER DATA
     *************************************************/
    function renderOperationData(row) {
      // row ‡∏Ñ‡∏∑‡∏≠ operationData ‡∏à‡∏≤‡∏Å Apps Script
      // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á key (‡∏î‡∏π‡∏à‡∏≤‡∏Å log ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏°‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á):
      // - ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
      // - ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
      // - ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
      // - ‡∏ù‡πà‡∏≤‡∏¢
      // - ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
      // - ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
      // - ‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (code)
      // - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
      // - ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
      // - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•
      // - ‡∏™‡∏†‡∏≤‡∏û‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô
      // - ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á
      // - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£

      const get = (k, fallback) => (row && (row[k] || row[k] === 0) ? row[k] : (fallback || '-'));

      document.getElementById('empName').textContent = get('‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô');
      document.getElementById('empCode').textContent = get('‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô');
      document.getElementById('empPosition').textContent = get('‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');
      document.getElementById('empDept').textContent = get('‡∏ù‡πà‡∏≤‡∏¢');

      document.getElementById('opType').textContent = get('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
      document.getElementById('employmentType').textContent = get('‡∏™‡∏†‡∏≤‡∏û‡∏à‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô');

      document.getElementById('opDetail').textContent = get('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
      document.getElementById('opExtra').textContent = get('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');

      const rawEff = row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•'] || row['Effective Date'] || '';
      document.getElementById('effectiveDate').textContent = rawEff ? formatDateTime(rawEff) : '-';

      const rawCreated = row['‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á'] || row['createdAt'] || row['Created At'] || '';
      document.getElementById('createdAt').textContent = rawCreated ? formatDateTime(rawCreated) : '-';

      // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
      const status = row['‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£'] || row['status'] || 'pending_approver';
      setBadge(status);
    }

    /*************************************************
     * LOAD DOC INFO (JSONP)
     *************************************************/
    function loadDocInfo() {
      DOC_NO =
        getQueryParam('docNo') ||
        getQueryParam('id') ||
        getQueryParam('row') ||
        '';

      const subtitle = document.getElementById('headerSubtitle');

      if (!DOC_NO) {
        if (subtitle) {
          subtitle.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (docNo/id/row) ‡πÉ‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå';
        }
        setStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
        return;
      }

      if (subtitle) {
        subtitle.textContent = `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: ${DOC_NO}`;
      }

      setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö...', null);

      const callbackName = 'docCb_' + Date.now();
      const script = document.createElement('script');
      script.id = callbackName;

      const url =
        WEB_APP_URL +
        '?action=' + encodeURIComponent(ACTION_GET_DOC) +
        '&docNo=' + encodeURIComponent(DOC_NO) +
        '&callback=' + encodeURIComponent(callbackName);

      script.src = url;

      window[callbackName] = function(res) {
        if (!res || !res.success) {
          setStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
          cleanupJSONP(callbackName);
          return;
        }

        const doc = res.data || {};
        const op = doc.operationData || doc.row || {};
        const steps = doc.steps || [];

        renderOperationData(op);

        // history + approver name
        if (steps[2]) {
          document.getElementById('approverName').textContent =
            steps[2].name || '-';
        }
        if (steps[0]) {
          document.getElementById('historyStep1').textContent =
            (steps[0].name || '-') + ' (' + formatDateTime(steps[0].time) + ')';
        }
        if (steps[1]) {
          document.getElementById('historyStep2').textContent =
            (steps[1].name || '-') + ' (' + formatDateTime(steps[1].time) + ')';
        }

        document.getElementById('historyInfo').textContent =
          '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ';

        setStatus('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'success');
        cleanupJSONP(callbackName);
      };

      script.onerror = function() {
        setStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå', 'error');
        cleanupJSONP(callbackName);
      };

      document.head.appendChild(script);
    }

    /*************************************************
     * SIGNATURE CANVAS
     *************************************************/
    function setupSignatureCanvas() {
      const canvas = document.getElementById('signatureCanvas');
      const container = canvas.parentElement;
      const signStatusText = document.getElementById('signStatusText');
      const btnClear = document.getElementById('btnClearSign');

      function resizeCanvas() {
        const rect = container.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        const ctx = canvas.getContext('2d');
        ctx.scale(dpr, dpr);
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#111827';

        // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏≠‡∏ô resize
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hasSignature = false;
        signStatusText.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ã‡πá‡∏ô';
      }

      window.addEventListener('resize', () => {
        resizeCanvas();
      });

      resizeCanvas();

      const ctx = canvas.getContext('2d');
      let drawing = false;
      let lastX = 0;
      let lastY = 0;

      function startDrawing(x, y) {
        drawing = true;
        lastX = x;
        lastY = y;
      }

      function drawLine(x, y) {
        if (!drawing) return;
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();
        lastX = x;
        lastY = y;
        if (!hasSignature) {
          hasSignature = true;
          signStatusText.textContent = '‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
        }
      }

      function stopDrawing() {
        drawing = false;
      }

      // Mouse events
      canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        startDrawing(e.clientX - rect.left, e.clientY - rect.top);
      });

      canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        drawLine(e.clientX - rect.left, e.clientY - rect.top);
      });

      window.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseleave', stopDrawing);

      // Touch events
      canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const t = e.touches[0];
        startDrawing(t.clientX - rect.left, t.clientY - rect.top);
      }, { passive: false });

      canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const t = e.touches[0];
        drawLine(t.clientX - rect.left, t.clientY - rect.top);
      }, { passive: false });

      canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        stopDrawing();
      }, { passive: false });

      // Clear button
      btnClear.addEventListener('click', () => {
        const rect = canvas.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;
        ctx.setTransform(1, 0, 0, 1, 0, 0); // reset ‡∏Å‡πà‡∏≠‡∏ô
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#111827';

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        hasSignature = false;
        signStatusText.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ã‡πá‡∏ô';
      });
    }

    function getSignatureDataUrl() {
      const canvas = document.getElementById('signatureCanvas');
      if (!canvas) return '';
      return canvas.toDataURL('image/png');
    }

    /*************************************************
     * SUBMIT DECISION
     *************************************************/
    function submitDecision(decision) {
      if (!DOC_NO) {
        setStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (docNo) ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
        return;
      }
      if (!hasSignature) {
        setStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
        return;
      }
      if (isSubmitting) return;

      const reason = document.getElementById('decisionReason').value || '';

      if (decision === 'reject' && !reason.trim()) {
        setStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äú‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‚Äù', 'error');
        return;
      }

      isSubmitting = true;
      setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô...', null);

      const sigData = getSignatureDataUrl();

      // ‡πÉ‡∏ä‡πâ JSONP ‡πÄ‡∏ä‡πà‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö loadDocInfo (‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î CORS)
      const callbackName = 'submitCb_' + Date.now();
      const script = document.createElement('script');
      script.id = callbackName;

      const action = decision === 'approve' ? ACTION_APPROVE : ACTION_REJECT;

      const url =
        WEB_APP_URL +
        '?action=' + encodeURIComponent(action) +
        '&docNo=' + encodeURIComponent(DOC_NO) +
        '&decision=' + encodeURIComponent(decision) +
        '&reason=' + encodeURIComponent(reason) +
        '&signature=' + encodeURIComponent(sigData) +
        '&callback=' + encodeURIComponent(callbackName);

      script.src = url;

      window[callbackName] = function(res) {
        isSubmitting = false;

        if (!res || !res.success) {
          setStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (res && res.message ? res.message : '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'), 'error');
          cleanupJSONP(callbackName);
          return;
        }

        setStatus('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß', 'success');
        setBadge(decision === 'approve' ? 'approved' : 'rejected');

        // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥
        document.getElementById('btnApprove').disabled = true;
        document.getElementById('btnReject').disabled = true;

        cleanupJSONP(callbackName);
      };

      script.onerror = function() {
        isSubmitting = false;
        setStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡∏Ç‡∏ì‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
        cleanupJSONP(callbackName);
      };

      document.head.appendChild(script);
    }

    /*************************************************
     * EVENT LISTENERS
     *************************************************/
    function setupDecisionButtons() {
      const btnApprove = document.getElementById('btnApprove');
      const btnReject = document.getElementById('btnReject');

      btnApprove.addEventListener('click', () => {
        // set radio
        const approveRadio = document.querySelector('input[name="decision"][value="approve"]');
        if (approveRadio) approveRadio.checked = true;
        submitDecision('approve');
      });

      btnReject.addEventListener('click', () => {
        const rejectRadio = document.querySelector('input[name="decision"][value="reject"]');
        if (rejectRadio) rejectRadio.checked = true;
        submitDecision('reject');
      });
    }

    /*************************************************
     * INIT
     *************************************************/
    window.addEventListener('DOMContentLoaded', () => {
      setupSignatureCanvas();
      setupDecisionButtons();
      loadDocInfo();
    });
  </script>
</body>
</html>
