<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° IT - The Carpetmaker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ================= STYLES ================= */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    
    /* Header */
    .header { text-align: center; color: white; margin-bottom: 30px; animation: fadeInDown 0.6s ease-out; }
    .header h1 { font-size: 32px; font-weight: 600; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
    .header p { font-size: 16px; opacity: 0.95; }
    @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

    /* Menu Tabs */
    .menu-tabs { display: flex; gap: 10px; margin-bottom: 20px; background: white; padding: 10px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); flex-wrap: wrap; }
    .menu-tab { flex: 1; padding: 12px 16px; background: #f5f5f5; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: inherit; min-width: 120px; }
    .menu-tab:hover { background: #e0e0e0; transform: translateY(-2px); }
    .menu-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); }

    /* Content Area */
    .content-area { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 8px 32px rgba(0,0,0,0.15); min-height: 600px; animation: fadeIn 0.6s ease-out 0.3s both; }
    .menu-content { display: none; }
    .menu-content.active { display: block; animation: fadeInUp 0.4s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Components */
    .section-title { font-size: 24px; font-weight: 600; color: #333; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #667eea; }
    
    .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
    .search-box input { flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; font-family: inherit; }
    .search-box input:focus { outline: none; border-color: #667eea; }
    .search-box button { padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-family: inherit; }

    .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; align-items: flex-start; }
    .alert-info { background: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
    .alert-error { background: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }

    /* Cards (Menu 1) */
    .candidate-card { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 15px; transition: all 0.3s; position: relative; }
    .candidate-card:hover { border-color: #667eea; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transform: translateY(-2px); }
    
    .info-row { display: flex; margin-bottom: 8px; font-size: 15px; align-items: baseline; }
    .info-label { font-weight: 600; color: #555; min-width: 120px; }
    .info-value { color: #333; flex: 1; word-break: break-word; }

    .btn { padding: 10px 20px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: inherit; display: inline-flex; align-items: center; gap: 6px; text-decoration: none; }
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-top: 10px; }
    .btn-primary:hover { box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); transform: translateY(-1px); }

    /* Loading Spinner */
    .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #667eea; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Status list (Menu 2 & 3) */
    .status-list-container {
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      overflow: hidden;
    }
    .status-header,
    .status-row {
      display: grid;
      grid-template-columns: 1.2fr 1.2fr 1fr;
      gap: 12px;
      padding: 10px 14px;
      font-size: 14px;
      align-items: center;
    }
    .status-header {
      background: #f3f4ff;
      font-weight: 600;
      color: #4b5563;
    }
    .status-row {
      border-top: 1px solid #f3f4f6;
      cursor: pointer;
      transition: background 0.15s ease;
    }
    .status-row:hover {
      background: #f9fafb;
    }
    .status-col-id { font-weight: 600; color: #111827; }
    .status-col-date { color: #4b5563; }
    .status-col-status { text-align: left; }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }
    .badge-pending {
      background: #fef3c7;
      color: #92400e;
    }
    .badge-approval {
      background: #e0f2fe;
      color: #075985;
    }
    .badge-approved {
      background: #dcfce7;
      color: #166534;
    }
    .badge-rejected {
      background: #fee2e2;
      color: #991b1b;
    }

    .pagination-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 13px;
      color: #4b5563;
    }
    .pagination-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: white;
      cursor: pointer;
      font-size: 13px;
      font-family: inherit;
    }
    .pagination-btn:disabled {
      opacity: 0.4;
      cursor: default;
    }

    /* Modal for status timeline */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal {
      background: #ffffff;
      border-radius: 16px;
      max-width: 520px;
      width: 100%;
      padding: 20px 22px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 14px;
    }
    .modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #111827;
    }
    .modal-sub {
      font-size: 13px;
      color: #6b7280;
      margin-top: 2px;
    }
    .modal-close-btn {
      border: none;
      background: transparent;
      font-size: 18px;
      cursor: pointer;
      color: #9ca3af;
    }
    .modal-close-btn:hover {
      color: #4b5563;
    }

    .timeline {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 14px 0 4px 0;
    }
    .timeline-step {
      flex: 1;
      text-align: center;
      position: relative;
    }
    .timeline-label {
      font-size: 13px;
      margin-top: 6px;
      color: #4b5563;
    }
    .circle {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 3px solid #d1d5db;
      margin: 0 auto;
      background: #f9fafb;
    }
    .circle.green {
      border-color: #16a34a;
      background: #bbf7d0;
    }
    .circle.yellow {
      border-color: #fbbf24;
      background: #fef3c7;
    }
    .circle.red {
      border-color: #f87171;
      background: #fee2e2;
    }
    .circle.grey {
      border-color: #d1d5db;
      background: #f9fafb;
    }

    .connector {
      position: absolute;
      top: 9px;
      left: 50%;
      right: -50%;
      height: 3px;
      background: #e5e7eb;
      z-index: -1;
    }
    .connector.blue {
      background: #bfdbfe;
    }

    .modal-section {
      margin-top: 10px;
      font-size: 13px;
      color: #374151;
    }
    .modal-section-row {
      display: flex;
      margin-bottom: 4px;
    }
    .modal-section-label {
      min-width: 90px;
      color: #6b7280;
    }
    .modal-section-value {
      flex: 1;
    }

    @media (max-width: 768px) {
      .info-row { flex-direction: column; }
      .info-label { margin-bottom: 2px; color: #777; font-size: 14px; }
      .menu-tabs { flex-direction: column; }
      .status-header,
      .status-row {
        grid-template-columns: 1.3fr 1.3fr 1fr;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üíª ‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</h1>
      <p>The Carpetmaker Co., Ltd.</p>
    </div>

    <div class="menu-tabs">
      <button class="menu-tab active" onclick="showMenu(1)">üìù ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (HRD)</button>
      <button class="menu-tab" onclick="showMenu(2)">üîç ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
      <button class="menu-tab" onclick="showMenu(3)">‚úÖ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
    </div>

    <div class="content-area">
      <!-- ===================== MENU 1 (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°) ===================== -->
      <div id="menu1" class="menu-content active">
        <h2 class="section-title">üìù ‡∏ú‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå (‡∏à‡∏≤‡∏Å HRD)</h2>
        
        <div class="alert alert-info">
          <span>‚ÑπÔ∏è</span>
          <div>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ï HRD Demo ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</div>
        </div>

        <div class="search-box">
          <input type="text" id="searchCandidate" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡πÅ‡∏ú‡∏ô‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á..." onkeyup="filterCandidates()">
        </div>

        <div id="loader" class="loader"></div>
        <div id="errorMessage" style="color: red; text-align: center; display: none;"></div>

        <div id="candidatesList"></div>
      </div>

      <!-- ===================== MENU 2: ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ===================== -->
      <div id="menu2" class="menu-content">
        <h2 class="section-title">üîç ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h2>

        <div class="alert alert-info">
          <span>‚ÑπÔ∏è</span>
          <div>
            ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° IT ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô)<br>
            ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠ / ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠ / ‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
          </div>
        </div>

        <div class="search-box">
          <input type="text" id="statusSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠, ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠, ‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞..." onkeyup="filterStatusList()">
        </div>

        <div id="statusLoader" class="loader"></div>
        <div id="statusError" style="color:red; text-align:center; display:none;"></div>

        <div class="status-list-container" id="statusListWrapper" style="display:none;">
          <div class="status-header">
            <div>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠</div>
            <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
            <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          </div>
          <div id="statusList"></div>
        </div>

        <div id="statusPagination"></div>
      </div>

      <!-- ===================== MENU 3: ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ===================== -->
      <div id="menu3" class="menu-content">
        <h2 class="section-title">‚úÖ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h2>

        <div class="alert alert-info">
          <span>‚ÑπÔ∏è</span>
          <div>
            ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå<br>
            ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
          </div>
        </div>

        <div class="search-box">
          <input type="text" id="approvalSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠, ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô..." onkeyup="filterApprovalList()">
        </div>

        <div id="approvalLoader" class="loader"></div>
        <div id="approvalError" style="color:red; text-align:center; display:none;"></div>

        <div class="status-list-container" id="approvalListWrapper" style="display:none;">
          <div class="status-header">
            <div>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠</div>
            <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
            <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          </div>
          <div id="approvalList"></div>
        </div>

        <div id="approvalPagination"></div>
      </div>
    </div>
  </div>

  <!-- ============== MODAL: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠ (Menu 2) ============== -->
  <div id="statusModalOverlay" class="modal-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="modalTitle">‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠ -</div>
          <div class="modal-sub" id="modalSub">‡∏ú‡∏π‡πâ‡∏Ç‡∏≠ - ¬∑ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -</div>
        </div>
        <button class="modal-close-btn" onclick="closeStatusModal()">‚úñ</button>
      </div>

      <div id="modalTimeline">
        <!-- ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
      </div>

      <div class="modal-section" id="modalDetail">
        <!-- ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î reviewer / approver -->
      </div>
    </div>
  </div>

  <script>
    // ========================================
    // CONFIG
    // ========================================
    const CONFIG = {
      WEB_APP_URL: "https://script.google.com/macros/s/AKfycbxe3OSwY-ko4E3qvVSyFQQ1W7OCZjufP-VmFT3LxPqFMwf_y8LO9A8cxFJjMvHvdj7ksQ/exec",
      FORM_URL: "https://spank1122.github.io/hrd_project/form.html"
    };

    // ========= Helper ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå + ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà =========
    function getRequestId(item) {
      // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á requestId (‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏Å‡πà‡∏≤) ‡πÅ‡∏•‡∏∞ requestNo (‡∏ù‡∏±‡πà‡∏á‡πÉ‡∏´‡∏°‡πà)
      return item.requestId || item.requestNo || '-';
    }

    function getRequester(item) {
      return item.requester || item.requesterName || '-';
    }

    function getDept(item) {
      return item.dept || item.requesterDept || item.deptName || '-';
    }

    function getStatusText(item) {
      return item.status || item.finalStatus || '-';
    }

    // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ISO ‚Üí dd/mm/yyyy
    function formatDateDisplay(value) {
      if (!value) return '-';
      const d = new Date(value);
      if (isNaN(d)) return value; // ‡∏ñ‡πâ‡∏≤ parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏¥‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
      const day   = ('0' + d.getDate()).slice(-2);
      const month = ('0' + (d.getMonth() + 1)).slice(-2);
      const year  = d.getFullYear();
      return `${day}/${month}/${year}`;
    }

    let allCandidates = [];

    // ====== ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π 2 & 3 ======
    const PAGE_SIZE_STATUS = 15;      // ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: 15 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£/‡∏´‡∏ô‡πâ‡∏≤
    const PAGE_SIZE_APPROVAL = 20;    // ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: 20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£/‡∏´‡∏ô‡πâ‡∏≤

    let statusDataAll = [];           // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (view=status)
    let approvalDataAll = [];         // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (view=approval)
    let statusPage = 1;
    let approvalPage = 1;

    let currentStatusItem = null;     // ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô modal

    // ========================================
    // MENU SWITCHING
    // ========================================
    function showMenu(n) {
      document.querySelectorAll('.menu-content').forEach(e => e.classList.remove('active'));
      document.querySelectorAll('.menu-tab').forEach(e => e.classList.remove('active'));
      document.getElementById("menu" + n).classList.add("active");
      document.querySelectorAll('.menu-tab')[n - 1].classList.add("active");
    }

    // ========================================
    // LOAD CANDIDATES (JSONP) - MENU 1
    // ========================================
    function loadCandidatesFromSheet() {
      document.getElementById('loader').style.display = "block";
      document.getElementById('errorMessage').style.display = "none";
      document.getElementById('candidatesList').innerHTML = "";

      const url = CONFIG.WEB_APP_URL +
        "?action=getCandidates" +
        "&callback=onCandidatesLoaded" +
        "&_=" + Date.now();

      const script = document.createElement("script");
      script.src = url;
      script.onerror = () => {
        document.getElementById('loader').style.display = "none";
        const err = document.getElementById('errorMessage');
        err.innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
        err.style.display = "block";
      };
      document.body.appendChild(script);
    }

    // ========================================
    // CALLBACK FROM APPS SCRIPT (JSONP) - MENU 1
    // ========================================
    function onCandidatesLoaded(result) {
      document.getElementById('loader').style.display = "none";

      if (!result || !result.success || !result.data) {
        document.getElementById('errorMessage').innerText =
          "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ";
        document.getElementById('errorMessage').style.display = "block";
        return;
      }

      allCandidates = result.data;
      renderList(allCandidates);
    }

    // ========================================
    // RENDER LIST - MENU 1
    // ========================================
    function renderList(data) {
      const listContainer = document.getElementById('candidatesList');
      let html = '';

      if (!data || data.length === 0) {
        listContainer.innerHTML =
          '<div style="text-align:center; padding:20px; color:#666;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</div>';
        return;
      }

      data.forEach(item => {
        html += `
          <div class="candidate-card">
            <div class="info-row">
              <div class="info-label">üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• (TH):</div>
              <div class="info-value"><strong>${item.name || '-'}</strong></div>
            </div>
            <div class="info-row">
              <div class="info-label">üî§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• (EN):</div>
              <div class="info-value">${item.nameEN || '-'}</div>
            </div>
            <div class="info-row">
              <div class="info-label">üíº ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</div>
              <div class="info-value">${item.position || '-'}</div>
            </div>
            <div class="info-row">
              <div class="info-label">üè¢ ‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô:</div>
              <div class="info-value">${item.dept || '-'}</div>
            </div>
            <div class="info-row">
              <div class="info-label">üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</div>
              <div class="info-value">${item.phone || '-'}</div>
            </div>
            
            <button class="btn btn-primary"
              onclick="openITRequestForm(
                '${item.email || ''}',
                '${item.purpose || ''}',
                '${item.name || ''}',
                '${item.dept || ''}',
                '${item.nameEN || ''}'
              )">
              üñäÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° IT
            </button>
          </div>
        `;
      });

      listContainer.innerHTML = html;
    }

    // ========================================
    // SEARCH - MENU 1
    // ========================================
    function filterCandidates() {
      const q = document.getElementById("searchCandidate").value.toLowerCase();

      const filtered = allCandidates.filter(c => {
        return (c.name || "").toLowerCase().includes(q)
          || (c.dept || "").toLowerCase().includes(q)
          || (c.position || "").toLowerCase().includes(q);
      });

      renderList(filtered);
    }

    // ========================================
    // OPEN IT FORM (GitHub) - MENU 1
    // ========================================
    function openITRequestForm(email, purpose, fullname, dept, candidateEn) {
      const params = new URLSearchParams();
      if (email)      params.append('email', email);
      if (fullname)   params.append('name', fullname);
      if (dept)       params.append('dept', dept);
      if (purpose)    params.append('purpose', purpose);
      if (candidateEn)params.append('candidateEn', candidateEn);

      const url = `${CONFIG.FORM_URL}?${params.toString()}`;
      console.log('IT Form URL =', url);
      window.open(url, '_blank');
    }

    // ========================================
    // LOAD STATUS (JSONP) - MENU 2 & 3
    // ========================================
    function loadStatus(view) {
      const loaderId     = view === 'status' ? 'statusLoader' : 'approvalLoader';
      const errorId      = view === 'status' ? 'statusError' : 'approvalError';
      const listWrapperId= view === 'status' ? 'statusListWrapper' : 'approvalListWrapper';
      const listId       = view === 'status' ? 'statusList' : 'approvalList';

      document.getElementById(loaderId).style.display = "block";
      document.getElementById(errorId).style.display = "none";
      document.getElementById(listId).innerHTML = "";
      document.getElementById(listWrapperId).style.display = "none";

      const callbackName = (view === 'status') ? 'onStatusLoaded_status' : 'onStatusLoaded_approval';

      const url = CONFIG.WEB_APP_URL +
        "?action=getStatus" +
        "&view=" + encodeURIComponent(view) +
        "&callback=" + callbackName +
        "&_=" + Date.now();

      const script = document.createElement("script");
      script.src = url;
      script.onerror = () => {
        document.getElementById(loaderId).style.display = "none";
        const err = document.getElementById(errorId);
        err.innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
        err.style.display = "block";
      };
      document.body.appendChild(script);
    }

    // CALLBACKs ‡∏à‡∏≤‡∏Å Apps Script
    function onStatusLoaded_status(result) {
      handleStatusResult('status', result);
    }

    function onStatusLoaded_approval(result) {
      handleStatusResult('approval', result);
    }

    function handleStatusResult(view, result) {
      const loaderId     = view === 'status' ? 'statusLoader' : 'approvalLoader';
      const errorId      = view === 'status' ? 'statusError'  : 'approvalError';
      const listWrapperId= view === 'status' ? 'statusListWrapper' : 'approvalListWrapper';
      const listId       = view === 'status' ? 'statusList'   : 'approvalList';

      document.getElementById(loaderId).style.display = "none";

      if (!result || !result.success) {
        document.getElementById(errorId).innerText =
          (result && result.message) ? result.message : '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ';
        document.getElementById(errorId).style.display = "block";
        return;
      }

      let data = result.data || [];

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‚Üí ‡πÄ‡∏Å‡πà‡∏≤ (‡πÉ‡∏ä‡πâ LastUpdated ‡∏Å‡πà‡∏≠‡∏ô ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ä‡πâ RequestTime)
      data.sort((a, b) => {
        const da = new Date(a.lastUpdated || a.requestTime || 0);
        const db = new Date(b.lastUpdated || b.requestTime || 0);
        return db - da;
      });

      if (view === 'status') {
        statusDataAll = data;
        statusPage = 1;
        if (statusDataAll.length === 0) {
          document.getElementById(listWrapperId).style.display = "none";
          document.getElementById(listId).innerHTML =
            '<div style="padding:14px; text-align:center; color:#6b7280;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>';
          return;
        }
        document.getElementById(listWrapperId).style.display = "block";
        renderStatusList('status', statusDataAll, listId, 'statusPagination');
      } else {
        // ‡∏ñ‡πâ‡∏≤ backend ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà filter ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤ filter ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Approved ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
        data = data.filter(item => {
          const s = (item.status || item.finalStatus || '').toLowerCase();
          return s === 'approved';
        });
        approvalDataAll = data;
        approvalPage = 1;
        if (approvalDataAll.length === 0) {
          document.getElementById(listWrapperId).style.display = "none";
          document.getElementById(listId).innerHTML =
            '<div style="padding:14px; text-align:center; color:#6b7280;">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</div>';
          return;
        }
        document.getElementById(listWrapperId).style.display = "block";
        renderStatusList('approval', approvalDataAll, listId, 'approvalPagination');
      }
    }

    // ========================================
    // RENDER STATUS LIST (Menu 2 & 3)
    // ========================================
    function renderStatusList(view, data, listId, paginationId) {
      const container = document.getElementById(listId);
      const paginationEl = document.getElementById(paginationId);

      if (!data || data.length === 0) {
        container.innerHTML =
          '<div style="padding:14px; text-align:center; color:#6b7280;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
        if (paginationEl) paginationEl.innerHTML = '';
        return;
      }

      const pageSize = (view === 'status') ? PAGE_SIZE_STATUS : PAGE_SIZE_APPROVAL;
      const page = (view === 'status') ? statusPage : approvalPage;
      const totalPages = Math.ceil(data.length / pageSize);

      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      const pageItems = data.slice(start, end);

      let html = '';

      pageItems.forEach(item => {
        const requestId      = getRequestId(item);
        const rawLastUpdated = item.lastUpdated || item.requestTime || '';
        const lastUpdated    = formatDateDisplay(rawLastUpdated);
        const statusRaw      = getStatusText(item);
        const statusLower    = statusRaw.toLowerCase();

        let badgeClass = 'badge-pending';
        if (statusLower === 'approved') badgeClass = 'badge-approved';
        else if (statusLower === 'pending approval') badgeClass = 'badge-approval';
        else if (statusLower === 'pending review') badgeClass = 'badge-pending';
        else if (statusLower === 'rejected' || statusLower === 'not approved') badgeClass = 'badge-rejected';

        if (view === 'status') {
          // ‡∏Ñ‡∏•‡∏¥‡∏Å ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
          html += `
            <div class="status-row" onclick="openStatusModal('${requestId}')">
              <div class="status-col-id">${requestId}</div>
              <div class="status-col-date">${lastUpdated}</div>
              <div class="status-col-status">
                <span class="badge ${badgeClass}">${statusRaw}</span>
              </div>
            </div>
          `;
        } else {
          // view = approval, ‡∏Ñ‡∏•‡∏¥‡∏Å ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î PDF Final
          const pdfUrl = item.pdfUrl || item.finalPdfUrl || '';
          html += `
            <div class="status-row" onclick="openFinalPdf('${pdfUrl}')">
              <div class="status-col-id">${requestId}</div>
              <div class="status-col-date">${lastUpdated}</div>
              <div class="status-col-status">
                <span class="badge badge-approved">Approved</span>
              </div>
            </div>
          `;
        }
      });

      container.innerHTML = html;

      // Pagination
      if (paginationEl) {
        paginationEl.innerHTML = `
          <div class="pagination-bar">
            <button class="pagination-btn"
              onclick="changePage('${view}', -1)"
              ${page <= 1 ? 'disabled' : ''}>
              ‚óÄ ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            </button>
            <div>
              ‡∏´‡∏ô‡πâ‡∏≤ ${page} / ${totalPages} (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
            </div>
            <button class="pagination-btn"
              onclick="changePage('${view}', 1)"
              ${page >= totalPages ? 'disabled' : ''}>
              ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂
            </button>
          </div>
        `;
      }
    }

    function changePage(view, delta) {
      if (view === 'status') {
        const total = Math.ceil((statusDataAll || []).length / PAGE_SIZE_STATUS);
        statusPage = Math.min(Math.max(1, statusPage + delta), total);
        renderStatusList('status', statusDataAll, 'statusList', 'statusPagination');
      } else {
        const total = Math.ceil((approvalDataAll || []).length / PAGE_SIZE_APPROVAL);
        approvalPage = Math.min(Math.max(1, approvalPage + delta), total);
        renderStatusList('approval', approvalDataAll, 'approvalList', 'approvalPagination');
      }
    }

    // ========================================
    // FILTER LIST (Menu 2)
    // ========================================
    function filterStatusList() {
      const q = (document.getElementById('statusSearch').value || '').toLowerCase();

      if (!statusDataAll || statusDataAll.length === 0) return;

      const filtered = statusDataAll.filter(item => {
        const requestId = getRequestId(item).toLowerCase();
        const requester = getRequester(item).toLowerCase();
        const dept      = getDept(item).toLowerCase();
        const status    = getStatusText(item).toLowerCase();
        return requestId.includes(q)
          || requester.includes(q)
          || dept.includes(q)
          || status.includes(q);
      });

      statusPage = 1;
      renderStatusList('status', filtered, 'statusList', 'statusPagination');
    }

    // ========================================
    // FILTER LIST (Menu 3)
    // ========================================
    function filterApprovalList() {
      const q = (document.getElementById('approvalSearch').value || '').toLowerCase();

      if (!approvalDataAll || approvalDataAll.length === 0) return;

      const filtered = approvalDataAll.filter(item => {
        const requestId = getRequestId(item).toLowerCase();
        const requester = getRequester(item).toLowerCase();
        const dept      = getDept(item).toLowerCase();
        return requestId.includes(q)
          || requester.includes(q)
          || dept.includes(q);
      });

      approvalPage = 1;
      renderStatusList('approval', filtered, 'approvalList', 'approvalPagination');
    }

    // ========================================
    // MODAL: ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠ (Menu 2)
    // ========================================
    function openStatusModal(requestId) {
      if (!statusDataAll || statusDataAll.length === 0) return;

      const item = statusDataAll.find(r => String(getRequestId(r)) === String(requestId));
      if (!item) return;

      currentStatusItem = item;

      const requester = getRequester(item);
      const dept      = getDept(item);
      const statusRaw = getStatusText(item);

      const createdAtRaw   = item.requestTime || item.createdAt || item.lastUpdated || '';
      const createdAt      = formatDateDisplay(createdAtRaw);
      const reviewer       = item.reviewer || '-';
      const reviewerAction = item.reviewerAction || item.reviewerStatus || '';
      const reviewerTime   = formatDateDisplay(item.reviewerActionTime || '');
      const approver       = item.approver || '-';
      const approverAction = item.approverAction || item.approverStatus || '';
      const approverTime   = formatDateDisplay(item.approverActionTime || '');

      document.getElementById('modalTitle').innerText =
        `‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${getRequestId(item)}`;
      document.getElementById('modalSub').innerText =
        `‡∏ú‡∏π‡πâ‡∏Ç‡∏≠: ${requester} (${dept}) ¬∑ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${statusRaw}`;

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô
      const colors = computeStepColors(item);

      const timelineHtml = `
        <div class="timeline">
          <div class="timeline-step">
            <div class="circle ${colors.reqCircle}"></div>
            <div class="connector ${colors.reqToRevLine}"></div>
            <div class="timeline-label">‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</div>
          </div>
          <div class="timeline-step">
            <div class="circle ${colors.revCircle}"></div>
            <div class="connector ${colors.revToAppLine}"></div>
            <div class="timeline-label">‡∏ú‡∏π‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô</div>
          </div>
          <div class="timeline-step">
            <div class="circle ${colors.appCircle}"></div>
            <div class="timeline-label">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
          </div>
        </div>
      `;
      document.getElementById('modalTimeline').innerHTML = timelineHtml;

      const detailHtml = `
        <div class="modal-section-row">
          <div class="modal-section-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:</div>
          <div class="modal-section-value">${createdAt}</div>
        </div>
        <div class="modal-section-row">
          <div class="modal-section-label">‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</div>
          <div class="modal-section-value">${requester}</div>
        </div>
        <div class="modal-section-row">
          <div class="modal-section-label">‡∏ú‡∏π‡πâ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô:</div>
          <div class="modal-section-value">
            ${reviewer} ${reviewerAction ? '(' + reviewerAction + ')' : ''}
            ${reviewerTime ? ' ¬∑ ' + reviewerTime : ''}
          </div>
        </div>
        <div class="modal-section-row">
          <div class="modal-section-label">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</div>
          <div class="modal-section-value">
            ${approver} ${approverAction ? '(' + approverAction + ')' : ''}
            ${approverTime ? ' ¬∑ ' + approverTime : ''}
          </div>
        </div>
      `;
      document.getElementById('modalDetail').innerHTML = detailHtml;

      document.getElementById('statusModalOverlay').style.display = 'flex';
    }

    function closeStatusModal() {
      document.getElementById('statusModalOverlay').style.display = 'none';
    }

    function computeStepColors(item) {
      const statusRaw = (item.status || item.finalStatus || '').toLowerCase();
      const reviewerAction = (item.reviewerAction || item.reviewerStatus || '').toLowerCase();
      const approverAction = (item.approverAction || item.approverStatus || '').toLowerCase();

      // default
      let reqCircle = 'green';
      let revCircle = 'grey';
      let appCircle = 'grey';
      let reqToRevLine = 'grey';
      let revToAppLine = 'grey';

      // ‡πÄ‡∏£‡∏¥‡πà‡∏°: ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß
      reqCircle = 'green';
      reqToRevLine = 'blue';

      if (reviewerAction === 'rejected' || statusRaw === 'rejected') {
        revCircle = 'red';
        appCircle = 'grey';
        revToAppLine = 'grey';
        return { reqCircle, revCircle, appCircle, reqToRevLine, revToAppLine };
      }

      if (approverAction === 'rejected') {
        revCircle = 'green';
        appCircle = 'red';
        reqToRevLine = 'blue';
        revToAppLine = 'blue';
        return { reqCircle, revCircle, appCircle, reqToRevLine, revToAppLine };
      }

      if (statusRaw === 'pending review' || (!reviewerAction && !approverAction)) {
        revCircle = 'yellow';
        appCircle = 'grey';
        revToAppLine = 'grey';
        return { reqCircle, revCircle, appCircle, reqToRevLine, revToAppLine };
      }

      if (statusRaw === 'pending approval' || (reviewerAction === 'approved' && !approverAction)) {
        revCircle = 'green';
        appCircle = 'yellow';
        reqToRevLine = 'blue';
        revToAppLine = 'blue';
        return { reqCircle, revCircle, appCircle, reqToRevLine, revToAppLine };
      }

      if (statusRaw === 'approved' || (reviewerAction === 'approved' && approverAction === 'approved')) {
        revCircle = 'green';
        appCircle = 'green';
        reqToRevLine = 'blue';
        revToAppLine = 'blue';
        return { reqCircle, revCircle, appCircle, reqToRevLine, revToAppLine };
      }

      return { reqCircle, revCircle, appCircle, reqToRevLine, revToAppLine };
    }

    // ========================================
    // OPEN FINAL PDF (Menu 3)
    // ========================================
    function openFinalPdf(pdfUrl) {
      if (!pdfUrl) {
        alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå PDF ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ô‡∏µ‡πâ');
        return;
      }
      window.open(pdfUrl, '_blank');
    }

    // ========================================
    // INIT
    // ========================================
    window.onload = () => {
      // ‡πÄ‡∏°‡∏ô‡∏π 1 (‡πÄ‡∏î‡∏¥‡∏°)
      loadCandidatesFromSheet();
      // ‡πÄ‡∏°‡∏ô‡∏π 2 & 3: ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
      loadStatus('status');
      loadStatus('approval');
    };
  </script>
</body>
</html>
