<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sarabun', 'Roboto', Arial, sans-serif;
      background-color: #f0ebf8;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 760px;
      margin: 0 auto;
    }

    .form-header {
      background: #673ab7;
      color: white;
      padding: 24px;
      border-radius: 8px 8px 0 0;
      margin-bottom: 12px;
    }

    .form-header h1 {
      font-size: 32px;
      font-weight: 400;
      margin-bottom: 8px;
    }

    .form-header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .question-card {
      background: white;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 12px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .question-label {
      font-size: 16px;
      color: #202124;
      margin-bottom: 8px;
      display: block;
    }

    .required {
      color: #d93025;
      margin-left: 4px;
    }

    input[type="text"],
    input[type="email"],
    input[type="date"],
    textarea,
    select {
      width: 100%;
      padding: 13px 15px;
      border: none;
      border-bottom: 1px solid #dadce0;
      font-size: 16px;
      font-family: inherit;
      background: transparent;
      transition: border-color 0.2s;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-bottom: 2px solid #673ab7;
    }

    input::placeholder,
    textarea::placeholder {
      color: #80868b;
    }

    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23202124' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      padding-right: 32px;
    }

    textarea {
      min-height: 100px;
      resize: vertical;
      border: 1px solid #dadce0;
      border-radius: 4px;
      padding: 13px 15px;
    }

    .options-group {
      margin-top: 16px;
    }

    .option-item {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      min-height: 32px;
    }

    .option-item input[type="checkbox"],
    .option-item input[type="radio"] {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .option-item label {
      font-size: 14px;
      color: #202124;
      cursor: pointer;
      flex: 1;
    }

    .option-item input[type="text"] {
      width: 300px;
      margin-left: 8px;
      padding: 8px 12px;
      border: 1px solid #dadce0;
      border-radius: 4px;
    }

    .signature-section {
      background: #f8f9fa;
      padding: 16px;
      border-radius: 4px;
      margin-top: 16px;
    }

    .signature-section h3 {
      font-size: 16px;
      color: #202124;
      margin-bottom: 12px;
      font-weight: 500;
    }

    canvas {
      border: 2px dashed #dadce0;
      border-radius: 4px;
      cursor: crosshair;
      touch-action: none;
      display: block;
      width: 100%;
      background: white;
      margin: 12px 0;
    }

    .button-group {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    button {
      padding: 10px 24px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .btn-clear {
      background: white;
      color: #673ab7;
      border: 1px solid #dadce0;
    }

    .btn-clear:hover {
      background: #f8f9fa;
    }

    .btn-submit {
      background: #673ab7;
      color: white;
      padding: 10px 32px;
    }

    .btn-submit:hover:not(:disabled) {
      background: #5e35b1;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }

    button:disabled {
      background: #dadce0 !important;
      color: #80868b !important;
      cursor: not-allowed;
    }

    #status {
      margin-top: 16px;
      padding: 16px;
      border-radius: 4px;
      display: none;
      font-size: 14px;
    }

    .success {
      background: #e8f5e9;
      color: #1e7e34;
      border-left: 4px solid #2e7d32;
    }

    .error {
      background: #fce4ec;
      color: #c62828;
      border-left: 4px solid #d32f2f;
    }

    .loading {
      background: #fff3e0;
      color: #e65100;
      border-left: 4px solid #f57c00;
    }

    .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(0,0,0,.1);
      border-radius: 50%;
      border-top-color: #673ab7;
      animation: spin 0.8s ease-in-out infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .helper-text {
      font-size: 12px;
      color: #5f6368;
      margin-top: 8px;
    }

    @media (max-width: 768px) {
      .form-header h1 {
        font-size: 24px;
      }
      
      .question-card {
        padding: 16px;
      }

      .option-item input[type="text"] {
        width: 100%;
        margin-left: 0;
        margin-top: 8px;
      }

      .button-group {
        flex-direction: column;
        width: 100%;
      }

      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="form-header">
      <h1>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</h1>
      <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á</p>
    </div>

    <form id="itRequestForm">
      
      <div class="question-card">
        <label class="question-label">
          ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á
          <span class="required">*</span>
        </label>
        <select id="name" name="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á" required>
          <option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</option>
        </select>
      </div>

      <div class="question-card">
        <label class="question-label">
          ‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á
          <span class="required">*</span>
        </label>
        <input type="text" id="dept" name="‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á" placeholder="‡πÅ‡∏ú‡∏ô‡∏Å‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠" readonly required>
      </div>

      <div class="question-card">
        <label class="question-label">‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
        <div class="options-group">
          <div class="option-item">
            <input type="checkbox" name="equipment" value="Computer Note Book" id="equipNotebook">
            <label for="equipNotebook">Computer Note Book</label>
          </div>
          <div class="option-item">
            <input type="checkbox" name="equipment" value="Computer PC" id="equipPC">
            <label for="equipPC">Computer PC</label>
          </div>
          <div class="option-item">
            <input type="checkbox" name="equipment" value="Soft Ware" id="equipSoft">
            <label for="equipSoft">Soft Ware</label>
          </div>
          <div class="option-item">
            <input type="checkbox" name="equipment" value="Hard Ware" id="equipHard">
            <label for="equipHard">Hard Ware</label>
          </div>
          <div class="option-item">
            <input type="checkbox" id="equipOther">
            <label for="equipOther">‡∏≠‡∏∑‡πà‡∏ô‡πÜ:</label>
            <input type="text" id="equipOtherText" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏">
          </div>
        </div>
      </div>

      <div class="question-card">
        <label class="question-label">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
        <div class="options-group">
          <div class="option-item">
            <input type="checkbox" name="software" value="Microsoft Office" id="softMS">
            <label for="softMS">Microsoft Office</label>
          </div>
          <div class="option-item">
            <input type="checkbox" name="software" value="Open Office" id="softOpen">
            <label for="softOpen">Open Office</label>
          </div>
          <div class="option-item">
            <input type="checkbox" id="softwareOther">
            <label for="softwareOther">‡∏≠‡∏∑‡πà‡∏ô‡πÜ:</label>
            <input type="text" id="softwareOtherText" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏">
          </div>
        </div>
      </div>

      <div class="question-card">
        <label class="question-label">‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£</label>
        <div class="options-group">
          <div class="option-item">
            <input type="radio" name="businessCard" value="‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£ Digital" id="cardDigital">
            <label for="cardDigital">‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£ Digital</label>
          </div>
          <div class="option-item">
            <input type="radio" name="businessCard" value="‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©" id="cardPaper">
            <label for="cardPaper">‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©</label>
          </div>
        </div>
      </div>

      <div class="question-card">
        <label class="question-label">Email</label>
        <input type="email" id="email" name="Email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£" readonly>
        <p class="helper-text">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</p>
      </div>

      <div class="question-card">
        <label class="question-label">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô</label>
        <div class="options-group">
          <div class="option-item">
            <input type="radio" name="stationery" value="‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" id="stationeryYes">
            <label for="stationeryYes">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
          </div>
          <div class="option-item">
            <input type="radio" name="stationery" value="‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" id="stationeryNo">
            <label for="stationeryNo">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
          </div>
        </div>
      </div>

      <div class="question-card">
        <label class="question-label">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</label>
        <div class="options-group">
          <div class="option-item">
            <input type="radio" name="mobilePhone" value="‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" id="phoneYes">
            <label for="phoneYes">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
          </div>
          <div class="option-item">
            <input type="radio" name="mobilePhone" value="‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" id="phoneNo">
            <label for="phoneNo">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
          </div>
        </div>
      </div>

      <div class="question-card">
        <label class="question-label">‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ö‡∏≠‡∏£‡πå</label>
        <input type="text" id="phoneNumber" name="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
      </div>

      <div class="question-card">
        <label class="question-label">
          ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)
          <span class="required">*</span>
        </label>
        <textarea id="purpose" name="‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" required></textarea>
      </div>

      <div class="question-card">
        <label class="question-label">
          ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°
          <span class="required">*</span>
        </label>
        <textarea id="reason" name="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•" required></textarea>
      </div>

      <div class="question-card">
        <label class="question-label">Spec. /Type. /‡∏£‡∏∏‡πà‡∏ô /‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</label>
        <textarea id="specs" name="Spec. /Type. /‡∏£‡∏∏‡πà‡∏ô /‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡πÄ‡∏õ‡∏Ñ"></textarea>
      </div>

      <div class="question-card">
        <label class="question-label">‡∏£‡∏≤‡∏Ñ‡∏≤ /‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ /‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</label>
        <input type="text" id="budget" name="‡∏£‡∏≤‡∏Ñ‡∏≤ /‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ /‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì">
      </div>

      <div class="question-card">
        <label class="question-label">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
        <div class="options-group">
          <div class="option-item">
            <input type="checkbox" name="budgetType" value="‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡πÅ‡∏ó‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤" id="budgetReplace">
            <label for="budgetReplace">‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡πÅ‡∏ó‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤</label>
          </div>
          <div class="option-item">
            <input type="checkbox" name="budgetType" value="‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì" id="budgetNone">
            <label for="budgetNone">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
          </div>
          <div class="option-item">
            <input type="checkbox" id="budgetTypeOther">
            <label for="budgetTypeOther">‡∏≠‡∏∑‡πà‡∏ô‡πÜ:</label>
            <input type="text" id="budgetTypeOtherText" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏">
          </div>
        </div>
      </div>

      <div class="question-card">
        <label class="question-label">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</label>
        <input type="date" id="deliveryDate" name="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö">
      </div>

      <div class="question-card">
        <div class="signature-section">
          <h3>‚úçÔ∏è ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á <span class="required">*</span></h3>
          <canvas id="signatureCanvas" width="800" height="200"></canvas>
          <button type="button" class="btn-clear" onclick="clearSignature()">
            ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
          </button>
        </div>
      </div>

      <div class="question-card">
        <div class="button-group">
          <button type="submit" class="btn-submit" id="submitBtn">
            ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠
          </button>
        </div>
        <div id="status"></div>
      </div>

    </form>
  </div>

  <script>
    // ========================================
    // üîß Configuration
    // ========================================
    const CONFIG = {
      APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycby8mvClK8QLmiSVyu91y4M1qaRt1xpRBIRPkbSAsh1rRXJP_u3iF1Ic2j1k8WTkb0-e0g/exec'
    };

    // ========================================
    // üîß ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Prefill ‡∏à‡∏≤‡∏Å URL Parameters
    // ========================================
    const urlParams = new URLSearchParams(window.location.search);
    const prefillData = {
      name: urlParams.get('name') || '',
      dept: urlParams.get('dept') || '',
      email: urlParams.get('email') || '',
      purpose: urlParams.get('purpose') || ''
    };

    console.log('üì• Prefill Data:', prefillData);

    // ========================================
    // üé® Signature Canvas Setup
    // ========================================
    let canvas, ctx, isDrawing = false, hasSignature = false;

    function initCanvas() {
      canvas = document.getElementById('signatureCanvas');
      ctx = canvas.getContext('2d');
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';

      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);
      canvas.addEventListener('touchstart', handleTouch);
      canvas.addEventListener('touchmove', handleTouch);
      canvas.addEventListener('touchend', stopDrawing);
    }

    function startDrawing(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      ctx.beginPath();
      ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
      hasSignature = true;
    }

    function draw(e) {
      if (!isDrawing) return;
      const rect = canvas.getBoundingClientRect();
      ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
      ctx.stroke();
    }

    function stopDrawing() {
      isDrawing = false;
    }

    function handleTouch(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent(
        e.type === 'touchstart' ? 'mousedown' : e.type === 'touchmove' ? 'mousemove' : 'mouseup',
        { clientX: touch.clientX, clientY: touch.clientY }
      );
      canvas.dispatchEvent(mouseEvent);
    }

    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      hasSignature = false;
    }

    // ========================================
    // üìã HR Master Data & Form Logic
    // ========================================
    let hrMasterData = [];

    function showStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = type;
      statusDiv.style.display = 'block';

      if (type === 'success' || type === 'error') {
        setTimeout(() => statusDiv.style.display = 'none', 5000);
      }
    }

    // ========================================
    // ‚úÖ JSONP: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• HR Master Data
    // ========================================
    function loadHRMasterData() {
      showStatus('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô...', 'loading');

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á callback function ‡∏ä‡∏∑‡πà‡∏≠ unique
      const callbackName = 'hrDataCallback_' + Date.now();
      
      // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î callback function
      window[callbackName] = function(result) {
        console.log('üìä HR Master Data:', result);
        
        if (result.success && result.data) {
          hrMasterData = result.data;
          populateRequesterDropdown();
          applyPrefillData();
          showStatus('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (' + hrMasterData.length + ' ‡∏Ñ‡∏ô)', 'success');
        } else {
          showStatus('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + (result.message || ''), 'error');
        }
        
        // ‡∏•‡∏ö script tag ‡πÅ‡∏•‡∏∞ callback
        document.body.removeChild(script);
        delete window[callbackName];
      };

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á script tag ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö JSONP
      const script = document.createElement('script');
      script.src = CONFIG.APPS_SCRIPT_URL + 
                   '?action=getHRMasterData' +
                   '&callback=' + callbackName;
      
      script.onerror = function() {
        showStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
        delete window[callbackName];
      };
      
      document.body.appendChild(script);
    }

    // ========================================
    // üìã Populate Dropdown
    // ========================================
    function populateRequesterDropdown() {
      const select = document.getElementById('name');
      select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á --</option>';
      
      hrMasterData.forEach((person, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = person.name;
        select.appendChild(option);
      });
    }

    // ========================================
    // üîÑ Prefill Data
    // ========================================
    function applyPrefillData() {
      if (prefillData.email) {
        const matchedIndex = hrMasterData.findIndex(person => {
          const email = generateEmailFromName(person.email);
          return email.toLowerCase() === prefillData.email.toLowerCase();
        });
        
        if (matchedIndex !== -1) {
          document.getElementById('name').value = matchedIndex;
          document.getElementById('dept').value = hrMasterData[matchedIndex].dept;
          document.getElementById('email').value = generateEmailFromName(hrMasterData[matchedIndex].email);
          console.log('‚úÖ Auto-selected:', hrMasterData[matchedIndex].name);
        }
      }
      
      if (prefillData.purpose) {
  document.getElementById('purpose').value = prefillData.purpose;
  console.log('‚úÖ Prefilled purpose:', prefillData.purpose);
      }
    }

    // ========================================
    // üë§ Name Change Handler
    // ========================================
    document.getElementById('name').addEventListener('change', function() {
      const index = parseInt(this.value);
      
      if (isNaN(index) || index < 0) {
        document.getElementById('dept').value = '';
        document.getElementById('email').value = '';
        return;
      }

      const person = hrMasterData[index];
      document.getElementById('dept').value = person.dept || '';
      document.getElementById('email').value = generateEmailFromName(person.email);
    });

    // ========================================
    // üìß Generate Email
    // ========================================
    function generateEmailFromName(fullNameEN) {
      if (!fullNameEN) return '';
      const parts = fullNameEN.trim().split(/\s+/);
      if (parts.length < 2) return fullNameEN.toLowerCase() + '@carpetmaker.co.th';
      
      const firstName = parts[0].toLowerCase();
      const lastName = parts[parts.length - 1].toLowerCase();
      const lastNamePrefix = lastName.substring(0, 2);
      
      return firstName + lastNamePrefix + '@carpetmaker.co.th';
    }

    // ========================================
    // üì§ Form Submission (‡πÉ‡∏ä‡πâ fetch POST)
    // ========================================
    document.getElementById('itRequestForm').addEventListener('submit', function(e) {
      e.preventDefault();

      if (!hasSignature) {
        showStatus('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°', 'error');
        document.getElementById('signatureCanvas').scrollIntoView({ behavior: 'smooth' });
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="spinner"></span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

      showStatus('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'loading');

      const formData = collectFormData();
      console.log('üì¶ Form Data:', formData);

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL-encoded string
      const params = new URLSearchParams();
      for (const key in formData) {
        params.append(key, formData[key]);
      }

      // ‡∏™‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢ fetch
      fetch(CONFIG.APPS_SCRIPT_URL, {
        method: 'POST',
        body: params,
        redirect: 'follow'
      })
        .then(response => response.text())
        .then(text => {
          console.log('üì• Raw Response:', text);
          
          try {
            const result = JSON.parse(text);
            console.log('‚úÖ Submit Result:', result);
            
            if (result.success) {
              showStatus('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏Ç‡∏≠: ' + result.requestNo, 'success');
              
              setTimeout(() => {
                document.getElementById('itRequestForm').reset();
                clearSignature();
                submitBtn.disabled = false;
                submitBtn.innerHTML = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠';
                loadHRMasterData();
              }, 2000);
            } else {
              showStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + result.message, 'error');
              submitBtn.disabled = false;
              submitBtn.innerHTML = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠';
            }
          } catch (error) {
            console.error('‚ùå Error parsing response:', error);
            console.error('Response text:', text);
            
            // ‡∏ñ‡πâ‡∏≤ parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (redirect)
            if (text.includes('success') || text.includes('requestNo')) {
              showStatus('‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß', 'success');
              setTimeout(() => {
                document.getElementById('itRequestForm').reset();
                clearSignature();
                submitBtn.disabled = false;
                submitBtn.innerHTML = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠';
                loadHRMasterData();
              }, 2000);
            } else {
              showStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô response ‡πÑ‡∏î‡πâ', 'error');
              submitBtn.disabled = false;
              submitBtn.innerHTML = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠';
            }
          }
        })
        .catch(error => {
          console.error('‚ùå Submit Error:', error);
          showStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
          submitBtn.disabled = false;
          submitBtn.innerHTML = '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠';
        });
    });

    // ========================================
    // üì¶ Collect Form Data
    // ========================================
    function collectFormData() {
      const formData = {};
      const nameSelect = document.getElementById('name');
      const selectedIndex = parseInt(nameSelect.value);

      if (!isNaN(selectedIndex) && selectedIndex >= 0) {
        formData['‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á'] = hrMasterData[selectedIndex].name;
        formData['Email'] = generateEmailFromName(hrMasterData[selectedIndex].email);
      }

      formData['‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á'] = document.getElementById('dept').value;
      formData['‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)'] = document.getElementById('purpose').value;

      // ‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
      const equipment = [];
      document.querySelectorAll('input[name="equipment"]:checked').forEach(cb => equipment.push(cb.value));
      if (document.getElementById('equipOther').checked) {
        const text = document.getElementById('equipOtherText').value;
        if (text) equipment.push(text);
      }
      formData['‡∏Ç‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå'] = equipment.join(', ');

      // ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
      const software = [];
      document.querySelectorAll('input[name="software"]:checked').forEach(cb => software.push(cb.value));
      if (document.getElementById('softwareOther').checked) {
        const text = document.getElementById('softwareOtherText').value;
        if (text) software.push(text);
      }
      formData['‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'] = software.join(', ');

      const businessCard = document.querySelector('input[name="businessCard"]:checked');
      formData['‡∏ô‡∏≤‡∏°‡∏ö‡∏±‡∏ï‡∏£'] = businessCard ? businessCard.value : '';

      const stationery = document.querySelector('input[name="stationery"]:checked');
      formData['‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô'] = stationery ? stationery.value : '';

      const mobilePhone = document.querySelector('input[name="mobilePhone"]:checked');
      formData['‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠'] = mobilePhone ? mobilePhone.value : '';
      formData['‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå'] = document.getElementById('phoneNumber').value;

      formData['‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°'] = document.getElementById('reason').value;
      formData['Spec. /Type. /‡∏£‡∏∏‡πà‡∏ô /‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)'] = document.getElementById('specs').value;
      formData['‡∏£‡∏≤‡∏Ñ‡∏≤ /‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ /‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'] = document.getElementById('budget').value;

      // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
      const budgetTypes = [];
      document.querySelectorAll('input[name="budgetType"]:checked').forEach(cb => budgetTypes.push(cb.value));
      if (document.getElementById('budgetTypeOther').checked) {
        const text = document.getElementById('budgetTypeOtherText').value;
        if (text) budgetTypes.push(text);
      }
      formData['‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì'] = budgetTypes.join(', ');

      formData['‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö'] = document.getElementById('deliveryDate').value;
      formData['requesterSignature'] = canvas.toDataURL('image/png');
      formData['Time'] = new Date().toISOString();

      return formData;
    }

    // ========================================
    // üöÄ Initialize on Load
    // ========================================
    window.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ Initializing IT Request Form...');
      initCanvas();
      loadHRMasterData();
    });
  </script>
</body>
</html>
