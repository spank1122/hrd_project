<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      max-width: 900px;
      width: 100%;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      text-align: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 3px solid #667eea;
    }

    .company-name {
      color: #2c3e50;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 5px;
      line-height: 1.5;
    }

    h1 {
      color: #2c3e50;
      font-size: 24px;
      margin-top: 10px;
      font-weight: 700;
    }

    .info-box {
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 25px;
      border-left: 4px solid #667eea;
    }

    .info-row {
      display: flex;
      margin-bottom: 10px;
      align-items: flex-start;
    }

    .info-row:last-child {
      margin-bottom: 0;
    }

    .info-label {
      font-weight: 600;
      color: #34495e;
      min-width: 180px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .info-value {
      color: #2c3e50;
      flex: 1;
      font-weight: 500;
    }

    .evaluation-section {
      margin-bottom: 25px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 15px;
      padding: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .eval-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .eval-table thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .eval-table th {
      padding: 12px 8px;
      text-align: center;
      font-weight: 600;
      font-size: 13px;
      border: 1px solid #ddd;
    }

    .eval-table td {
      padding: 10px 8px;
      border: 1px solid #ddd;
      text-align: left;
    }

    .eval-table tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    .eval-table tbody tr:hover {
      background-color: #e9ecef;
    }

    .score-cell {
      text-align: center;
      font-weight: 700;
      font-size: 16px;
      color: #667eea;
    }

    .score-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
      color: white;
      font-weight: 700;
    }

    .comments-box {
      background: #fff3cd;
      border: 2px solid #ffc107;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .comments-title {
      font-weight: 700;
      color: #856404;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .comments-content {
      color: #856404;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
      font-size: 15px;
    }

    .required {
      color: #e74c3c;
      margin-left: 3px;
    }

    select, input[type="text"] {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s;
      background: white;
    }

    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    input[readonly] {
      background-color: #f8f9fa;
      color: #6c757d;
    }

    .canvas-wrapper {
      position: relative;
      margin-top: 10px;
    }

    #signatureCanvas {
      border: 2px dashed #667eea;
      border-radius: 10px;
      cursor: crosshair;
      touch-action: none;
      display: block;
      width: 100%;
      background: #fafafa;
      transition: all 0.3s;
    }

    #signatureCanvas:hover {
      background: white;
      border-color: #764ba2;
    }

    #signatureCanvas.drawing {
      border-style: solid;
      background: white;
    }

    .canvas-hint {
      text-align: center;
      color: #95a5a6;
      font-size: 13px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    button {
      flex: 1;
      padding: 14px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-clear {
      background: #95a5a6;
      color: white;
    }

    .btn-clear:hover {
      background: #7f8c8d;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(149, 165, 166, 0.3);
    }

    .btn-submit {
      background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
    }

    .btn-submit:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
    }

    .btn-submit:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #status {
      margin-top: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      display: none;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .status-icon {
      display: inline-block;
      margin-right: 8px;
      font-size: 18px;
    }

    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      border-left: 4px solid #28a745;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      border-left: 4px solid #dc3545;
    }

    .loading {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
      border-left: 4px solid #ffc107;
    }

    .pdf-link {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 20px;
      background: #3498db;
      color: white !important;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .pdf-link:hover {
      background: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 20px;
      }

      h1 {
        font-size: 20px;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }

      .info-row {
        flex-direction: column;
      }

      .info-label {
        margin-bottom: 5px;
      }

      .eval-table {
        font-size: 12px;
      }

      .eval-table th,
      .eval-table td {
        padding: 8px 4px;
      }
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .readonly-badge {
      display: inline-block;
      background: #e0e0e0;
      color: #666;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="company-name">
        ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Ñ‡∏≤‡∏£‡πå‡πÄ‡∏õ‡∏ó ‡πÄ‡∏°‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå(‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢) ‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÅ‡∏•‡∏∞<br>
        ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Ñ‡∏≤‡∏£‡πå‡πÄ‡∏õ‡∏ó ‡πÄ‡∏°‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏û‡∏µ2‡∏î‡∏±‡∏ö‡∏ö‡∏•‡∏¥‡∏ß (‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢) ‡∏à‡∏≥‡∏Å‡∏±‡∏î
      </div>
      <h1>‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h1>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
    <div class="info-box">
      <div class="info-row">
        <div class="info-label">
          <span>üë§</span>
          <span>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</span>
          <span class="readonly-badge">READ ONLY</span>
        </div>
        <div class="info-value" id="candidateName">-</div>
      </div>
      <div class="info-row">
        <div class="info-label">
          <span>üíº</span>
          <span>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</span>
          <span class="readonly-badge">READ ONLY</span>
        </div>
        <div class="info-value" id="candidatePosition">-</div>
      </div>
    </div>

    <!-- ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡∏à‡∏≤‡∏Å Google Form -->
    <div id="evaluationData">
      <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
    </div>

    <!-- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
    <div id="commentsSection">
      <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
    </div>

    <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô -->
    <div class="evaluation-section">
      <div class="section-title">
        <span>‚úçÔ∏è</span>
        <span>‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</span>
      </div>

      <div class="form-group">
        <label for="evaluatorSelect">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          <span class="required">*</span>
        </label>
        <select id="evaluatorSelect">
          <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì --</option>
        </select>
      </div>

      <div class="form-group">
        <label for="evaluatorPosition">
          ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
        </label>
        <input type="text" id="evaluatorPosition" readonly placeholder="‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠">
      </div>

      <div class="form-group">
        <label>
          ‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
          <span class="required">*</span>
        </label>
        <div class="canvas-wrapper">
          <canvas id="signatureCanvas" width="840" height="200"></canvas>
          <div class="canvas-hint">
            <span>‚úçÔ∏è</span>
            <span>‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏¥‡πâ‡∏ß‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
    <div class="button-group">
      <button class="btn-clear" onclick="clearSignature()">
        <span>üóëÔ∏è</span>
        <span>‡∏•‡∏ö‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</span>
      </button>
      <button class="btn-submit" id="submitBtn" onclick="submitSignature()">
        <span>‚úÖ</span>
        <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á PDF</span>
      </button>
    </div>

    <!-- Status Message -->
    <div id="status"></div>
  </div>

  <script>
    // ========== Data from Server ==========
    const RESPONSE_ID = '<?= responseId ?>';
    
    var evalData = null;
    var allEvaluators = [];

    // ========== Canvas Setup ==========
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let hasDrawn = false;

    ctx.strokeStyle = '#2c3e50';
    ctx.lineWidth = 2.5;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';

    // ========== Mouse Events ==========
    canvas.addEventListener('mousedown', function(e) {
      startDrawing(e.offsetX, e.offsetY);
    });

    canvas.addEventListener('mousemove', function(e) {
      if (!isDrawing) return;
      draw(e.offsetX, e.offsetY);
    });

    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    // ========== Touch Events (Mobile) ==========
    canvas.addEventListener('touchstart', function(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      startDrawing(x, y);
    });

    canvas.addEventListener('touchmove', function(e) {
      e.preventDefault();
      if (!isDrawing) return;
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      draw(x, y);
    });

    canvas.addEventListener('touchend', function(e) {
      e.preventDefault();
      stopDrawing();
    });

    // ========== Drawing Functions ==========
    function startDrawing(x, y) {
      isDrawing = true;
      canvas.classList.add('drawing');
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    function draw(x, y) {
      ctx.lineTo(x, y);
      ctx.stroke();
      hasDrawn = true;
    }

    function stopDrawing() {
      isDrawing = false;
      canvas.classList.remove('drawing');
    }

    // ========== Clear Signature ==========
    function clearSignature() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      hasDrawn = false;
      hideStatus();
    }

    // ========== Load Evaluation Data ==========
    window.addEventListener('load', function() {
      console.log('üé® Manager Signature Page Loaded');
      console.log('Response ID:', RESPONSE_ID);
      
      loadEvaluationData();
      loadEvaluators();
    });

    function loadEvaluationData() {
      google.script.run
        .withSuccessHandler(function(data) {
          evalData = data;
          displayEvaluationData(data);
        })
        .withFailureHandler(function(error) {
          showStatus('error', '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ: ' + error.message);
        })
        .getManagerEvalData(RESPONSE_ID);
    }

    function loadEvaluators() {
      google.script.run
        .withSuccessHandler(function(evaluators) {
          allEvaluators = evaluators || [];
          populateEvaluatorSelect(evaluators);
        })
        .withFailureHandler(function(error) {
          showStatus('error', '‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ: ' + error.message);
        })
        .getManagerEvaluators();
    }

    function populateEvaluatorSelect(evaluators) {
      const select = document.getElementById('evaluatorSelect');
      select.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì --</option>';

      evaluators.forEach(function(eval) {
        const option = document.createElement('option');
        option.value = JSON.stringify(eval);
        option.text = eval.name + ' - ' + eval.position;
        select.appendChild(option);
      });
    }

    function displayEvaluationData(data) {
      const evalObj = data.data;
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
      document.getElementById('candidateName').textContent = 
        evalObj['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] || '-';
      document.getElementById('candidatePosition').textContent = 
        evalObj['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£'] || '-';

      // üìä ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á 10 ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡∏ï‡∏≤‡∏°‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏à‡∏£‡∏¥‡∏á)
      const evalDataDiv = document.getElementById('evaluationData');
      
      // ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
      const evaluationCriteria = [
        {
          name: '‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤ ‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡∏°‡∏≤‡∏£‡∏¢‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤ ‡∏Å‡∏¥‡∏£‡∏¥‡∏¢‡∏≤‡∏°‡∏≤‡∏£‡∏¢‡∏≤‡∏ó‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢]'
        },
        {
          name: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô]'
        },
        {
          name: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô]'
        },
        {
          name: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≠‡∏ö‡∏£‡∏π‡πâ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≠‡∏ö‡∏£‡∏π‡πâ ‡πÉ‡∏ô‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á]'
        },
        {
          name: '‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏î‡∏∏‡∏•‡∏¢‡∏û‡∏¥‡∏ô‡∏¥‡∏à ‡πÑ‡∏´‡∏ß‡∏û‡∏£‡∏¥‡∏ö‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏î‡∏∏‡∏•‡∏¢‡∏û‡∏¥‡∏ô‡∏¥‡∏à ‡πÑ‡∏´‡∏ß‡∏û‡∏£‡∏¥‡∏ö‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°]'
        },
        {
          name: '‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [ ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠]'
        },
        {
          name: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÉ‡∏ô‡∏á‡∏≤‡∏ô',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÉ‡∏ô‡∏á‡∏≤‡∏ô]'
        },
        {
          name: '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß]'
        },
        {
          name: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏á‡∏≤‡∏ô]'
        },
        {
          name: '‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó',
          key: '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô [‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡πà‡∏≠‡∏á‡∏≤‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó]'
        }
      ];

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
      let tableHTML = `
        <div class="evaluation-section">
          <div class="section-title">
            <span>üìä</span>
            <span>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏à‡∏≤‡∏Å Google Form (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 10 ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠)</span>
            <span class="readonly-badge">READ ONLY</span>
          </div>
          <table class="eval-table">
            <thead>
              <tr>
                <th style="width: 50px;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                <th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</th>
                <th style="width: 150px;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (1-10)</th>
              </tr>
            </thead>
            <tbody>
      `;

      let totalScore = 0;
      let scoreCount = 0;

      evaluationCriteria.forEach(function(item, index) {
        const rawValue = evalObj[item.key] || '';
        
        // ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÄ‡∏ä‡πà‡∏ô "‡∏î‡∏µ‡∏°‡∏≤‡∏Å      95-100%      10" ‚Üí ‡πÄ‡∏≠‡∏≤‡πÄ‡∏•‡∏Ç 10
        let score = '-';
        if (rawValue) {
          const matches = String(rawValue).match(/(\d+)$/);
          if (matches) {
            score = parseInt(matches[1]);
            totalScore += score;
            scoreCount++;
          }
        }

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
        let badgeColor = '#27ae60'; // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (‡∏î‡∏µ‡∏°‡∏≤‡∏Å)
        if (score !== '-') {
          if (score >= 9) badgeColor = '#27ae60'; // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
          else if (score >= 8) badgeColor = '#3498db'; // ‡∏ü‡πâ‡∏≤ (‡∏î‡∏µ)
          else if (score >= 7) badgeColor = '#f39c12'; // ‡∏™‡πâ‡∏° (‡∏û‡∏≠‡πÉ‡∏ä‡πâ)
          else badgeColor = '#e74c3c'; // ‡πÅ‡∏î‡∏á (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á)
        }

        tableHTML += `
          <tr>
            <td style="text-align: center; font-weight: 700;">${index + 1}</td>
            <td>${item.name}</td>
            <td class="score-cell">
              <span class="score-badge" style="background: linear-gradient(135deg, ${badgeColor} 0%, ${badgeColor}cc 100%);">
                ${score}
              </span>
            </td>
          </tr>
        `;
      });

      tableHTML += `
            </tbody>
          </table>
      `;

      // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢
      if (scoreCount > 0) {
        const avgScore = (totalScore / scoreCount).toFixed(2);
        tableHTML += `
          <div style="text-align: right; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-weight: 600; color: #2c3e50;">
            <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: </span>
            <span style="font-size: 18px; color: #27ae60;">${avgScore}</span>
            <span> / 10</span>
          </div>
        `;
      }

      tableHTML += `</div>`;

      evalDataDiv.innerHTML = tableHTML;

      // üìã ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
      const additionalInfo = `
        <div class="evaluation-section">
          <div class="section-title">
            <span>üìã</span>
            <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</span>
            <span class="readonly-badge">READ ONLY</span>
          </div>
          <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            ${evalObj['‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô'] ? `
              <div class="info-row">
                <div class="info-label">üè¢ ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô:</div>
                <div class="info-value">${evalObj['‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô']}</div>
              </div>
            ` : ''}
            ${evalObj['‡πÅ‡∏ú‡∏ô‡∏Å'] ? `
              <div class="info-row">
                <div class="info-label">üìÇ ‡πÅ‡∏ú‡∏ô‡∏Å:</div>
                <div class="info-value">${evalObj['‡πÅ‡∏ú‡∏ô‡∏Å']}</div>
              </div>
            ` : ''}
            ${evalObj['‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô/‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á'] ? `
              <div class="info-row">
                <div class="info-label">üí∞ ‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô/‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á:</div>
                <div class="info-value">${evalObj['‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô/‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á']}</div>
              </div>
            ` : ''}
            ${evalObj['‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'] ? `
              <div class="info-row">
                <div class="info-label">üíº ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:</div>
                <div class="info-value">${evalObj['‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô']}</div>
              </div>
            ` : ''}
            ${evalObj['‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û'] ? `
              <div class="info-row">
                <div class="info-label">üë§ ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û:</div>
                <div class="info-value">${evalObj['‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û']}</div>
              </div>
            ` : ''}
            ${evalObj['‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°'] ? `
              <div class="info-row">
                <div class="info-label">üìä ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</div>
                <div class="info-value">${evalObj['‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°']}</div>
              </div>
            ` : ''}
            ${evalObj['‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô'] ? `
              <div class="info-row">
                <div class="info-label">‚úÖ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô:</div>
                <div class="info-value" style="font-weight: 700; color: ${evalObj['‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô'] === '‡πÉ‡∏ä‡πà' ? '#27ae60' : '#e74c3c'};">
                  ${evalObj['‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô']}
                </div>
              </div>
            ` : ''}
            ${evalObj['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô'] ? `
              <div class="info-row">
                <div class="info-label">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô:</div>
                <div class="info-value">${evalObj['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô']}</div>
              </div>
            ` : ''}
          </div>
        </div>
      `;

      evalDataDiv.innerHTML += additionalInfo;

      // üí¨ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
      const commentsDiv = document.getElementById('commentsSection');
      
      const comments = evalObj['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå'] || '';
      const otherComments = evalObj['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô / ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ'] || '';
      
      let commentsHTML = '';
      
      if (comments && String(comments).trim() !== '') {
        commentsHTML += `
          <div class="comments-box">
            <div class="comments-title">
              üí¨ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå:
              <span class="readonly-badge">READ ONLY</span>
            </div>
            <div class="comments-content">${String(comments).replace(/\n/g, '<br>')}</div>
          </div>
        `;
      }

      if (otherComments && String(otherComments).trim() !== '') {
        commentsHTML += `
          <div class="comments-box" style="background: #e8f4f8; border-color: #3498db;">
            <div class="comments-title" style="color: #1565c0;">
              üìù ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô / ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ:
              <span class="readonly-badge">READ ONLY</span>
            </div>
            <div class="comments-content" style="color: #1565c0;">${String(otherComments).replace(/\n/g, '<br>')}</div>
          </div>
        `;
      }

      commentsDiv.innerHTML = commentsHTML;

      // ‡πÅ‡∏™‡∏î‡∏á Timestamp ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      if (evalObj['Timestamp']) {
        const timestamp = new Date(evalObj['Timestamp']);
        const formattedTime = timestamp.toLocaleString('th-TH', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });

        const timestampDiv = document.createElement('div');
        timestampDiv.style.cssText = 'text-align: center; color: #7f8c8d; font-size: 12px; margin-top: 10px; padding: 8px; background: white; border-radius: 6px;';
        timestampDiv.innerHTML = `‚è∞ ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${formattedTime}`;
        evalDataDiv.appendChild(timestampDiv);
      }

      console.log('‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      console.log('üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á:', {
        ‡∏ä‡∏∑‡πà‡∏≠: evalObj['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'],
        ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: evalObj['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£'],
        ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô: evaluationCriteria.length
      });
    }

    // ========== Auto-fill Position ==========
    document.getElementById('evaluatorSelect').addEventListener('change', function() {
      const selected = this.value;
      if (selected) {
        try {
          const data = JSON.parse(selected);
          document.getElementById('evaluatorPosition').value = data.position;
        } catch (e) {
          console.error('Error parsing evaluator data:', e);
        }
      } else {
        document.getElementById('evaluatorPosition').value = '';
      }
    });

    // ========== Submit Signature ==========
    function submitSignature() {
      const submitBtn = document.getElementById('submitBtn');
      
      // Validation
      const evaluatorData = document.getElementById('evaluatorSelect').value;
      if (!evaluatorData) {
        showStatus('error', '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
        return;
      }

      if (!hasDrawn) {
        showStatus('error', '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }

      // Parse evaluator data
      let evaluator;
      try {
        evaluator = JSON.parse(evaluatorData);
      } catch (e) {
        showStatus('error', '‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        return;
      }

      // Get signature as Base64
      const signatureBase64 = canvas.toDataURL('image/png');

      // Disable button
      submitBtn.disabled = true;
      showStatus('loading', 
        '<div style="display:flex;align-items:center;gap:10px;">' +
        '<div class="spinner"></div>' +
        '<span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</span>' +
        '</div>'
      );

      // Send to server
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showStatus('success', 
              '<div class="status-icon">‚úÖ</div>' +
              '<strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong><br><br>' +
              result.message + '<br><br>' +
              '<a href="' + result.pdfUrl + '" target="_blank" class="pdf-link">üìÑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π PDF</a>'
            );
            submitBtn.style.display = 'none';
            document.querySelector('.btn-clear').style.display = 'none';
          } else {
            showStatus('error', '<div class="status-icon">‚ùå</div>' + result.message);
            submitBtn.disabled = false;
          }
        })
        .withFailureHandler(function(err) {
          showStatus('error', '<div class="status-icon">‚ùå</div>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message);
          submitBtn.disabled = false;
        })
        .saveManagerSignature(RESPONSE_ID, evaluator.name, evaluator.position, evaluator.email, signatureBase64);
    }

    // ========== Status Display ==========
    function showStatus(type, message) {
      const status = document.getElementById('status');
      status.className = type;
      status.innerHTML = message;
      status.style.display = 'block';
      
      status.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function hideStatus() {
      const status = document.getElementById('status');
      status.style.display = 'none';
    }
  </script>
</body>
</html>